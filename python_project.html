<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Python Project : How to characterize the features that make French communes have similar voting preferences in the first round of the 2017 presidential elections?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="python_project_files/libs/clipboard/clipboard.min.js"></script>
<script src="python_project_files/libs/quarto-html/quarto.js"></script>
<script src="python_project_files/libs/quarto-html/popper.min.js"></script>
<script src="python_project_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="python_project_files/libs/quarto-html/anchor.min.js"></script>
<link href="python_project_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="python_project_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="python_project_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="python_project_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="python_project_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Python Project : How to characterize the features that make French communes have similar voting preferences in the first round of the 2017 presidential elections?</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>Question and motivation</strong></p>
<p>In this notebook, we aim to visualize these spatial differences in political orientation and assess the criteria that characterize them at the “commune” level.</p>
<p>To do so, we will perform two clustering decompositions using the k-means method: the first decomposition will consider voting preferences based on the top 1 candidate (the one receiving the largest number of votes in a given commune), and the second will consider the top 3 candidates (the three candidates receiving the most votes). The variables used will include age categories, voting features of the candidates, urban density, socio-professional categories, education, median income, and other voting-related features.</p>
<p><em>A “commune” is a subdivision of French territories: France is composed of “regions,” which are divided into “departments,” which are further divided into “communes,” and these are divided into “IRIS” (statistical neighborhoods).</em></p>
<p>In order to do so we used different databases :</p>
<ul>
<li>Election : Election présidentielle des 23 avril et 7 mai 2017 - Résultats du 1er tour, Datagouv</li>
<li>Population : Population en 2018 Recensement de la population - Base infracommunale (IRIS), INSEE</li>
<li>Education : Diplômes - Formation en 2017 Recensement de la population - Base infracommunale (IRIS)</li>
<li>Municipal grid : La grille communale de densité, INSEE</li>
<li>Income : Structure et distribution des revenus, inégalité des niveaux de vie en 2017, INSEE</li>
</ul>
<section id="set-up" class="level1">
<h1>SET UP</h1>
<p><strong>We set the directories</strong></p>
<div id="cell-5" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>dir_data <span class="op">=</span> <span class="st">'/Users/waelbenhamouda/Documents/Master 2/Python Programming/Python Project/Data'</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>dir_figures <span class="op">=</span> <span class="st">'/Users/waelbenhamouda/Documents/Master 2/Python Programming/Python Project/Figures'</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>dir_html <span class="op">=</span> <span class="st">'/Users/waelbenhamouda/Documents/Master 2/Python Programming/Python Project/HTML'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Installing the needed packages</strong></p>
<p><em>xlrd : Library for reading data from Excel files (both .xls and .xlsx formats)</em></p>
<div id="cell-8" class="cell" data-outputid="2c2ed120-2465-4d39-a3fd-02c142663cc9" data-execution_count="5">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pip install xlrd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: xlrd in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (2.0.1)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>plotly : Library for creating interactive plots and visualizations in Python</em></p>
<div id="cell-10" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>pip install plotly</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: plotly in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (5.24.1)
Requirement already satisfied: tenacity&gt;=6.2.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from plotly) (9.0.0)
Requirement already satisfied: packaging in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from plotly) (24.1)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>requests : Library used for making HTTP requests, often used to access APIs or download data from the web</em></p>
<div id="cell-12" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>pip install requests</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: requests in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (2.32.3)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from requests) (3.4.0)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from requests) (3.10)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from requests) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from requests) (2024.8.30)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>seaborn : Statistical data visualization library built on top of matplotlib that provides more attractive and informative graphics</em></p>
<div id="cell-14" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>pip install seaborn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: seaborn in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (0.13.2)
Requirement already satisfied: numpy!=1.24.0,&gt;=1.20 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from seaborn) (2.0.0)
Requirement already satisfied: pandas&gt;=1.2 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from seaborn) (2.2.2)
Requirement already satisfied: matplotlib!=3.6.1,&gt;=3.4 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from seaborn) (3.9.0)
Requirement already satisfied: contourpy&gt;=1.0.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.2.1)
Requirement already satisfied: cycler&gt;=0.10 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (0.12.1)
Requirement already satisfied: fonttools&gt;=4.22.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (4.53.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.4.5)
Requirement already satisfied: packaging&gt;=20.0 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (24.1)
Requirement already satisfied: pillow&gt;=8 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (10.4.0)
Requirement already satisfied: pyparsing&gt;=2.3.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (3.1.2)
Requirement already satisfied: python-dateutil&gt;=2.7 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from pandas&gt;=1.2-&gt;seaborn) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from pandas&gt;=1.2-&gt;seaborn) (2024.1)
Requirement already satisfied: six&gt;=1.5 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from python-dateutil&gt;=2.7-&gt;matplotlib!=3.6.1,&gt;=3.4-&gt;seaborn) (1.16.0)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>scikit-learn : Library for machine learning algorithms, data processing, and model evaluation</em></p>
<div id="cell-16" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>pip install scikit<span class="op">-</span>learn</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: scikit-learn in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (1.5.2)
Requirement already satisfied: numpy&gt;=1.19.5 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from scikit-learn) (2.0.0)
Requirement already satisfied: scipy&gt;=1.6.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from scikit-learn) (1.14.0)
Requirement already satisfied: joblib&gt;=1.2.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from scikit-learn) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=3.1.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from scikit-learn) (3.5.0)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>-U kaleido : Library for exporting plotly visualizations as static images (e.g., PNG, PDF)</em></p>
<div id="cell-18" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>pip install <span class="op">-</span>U kaleido</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: kaleido in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (0.2.1)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><em>nbformat : Library required for working with Jupyter notebook formats, especially for conversion or rendering notebook content</em></p>
<div id="cell-20" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pip install nbformat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Requirement already satisfied: nbformat in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (5.10.4)
Requirement already satisfied: fastjsonschema&gt;=2.15 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from nbformat) (2.20.0)
Requirement already satisfied: jsonschema&gt;=2.6 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from nbformat) (4.23.0)
Requirement already satisfied: jupyter-core!=5.0.*,&gt;=4.12 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from nbformat) (5.7.2)
Requirement already satisfied: traitlets&gt;=5.1 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from nbformat) (5.14.3)
Requirement already satisfied: attrs&gt;=22.2.0 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat) (24.2.0)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat) (2024.10.1)
Requirement already satisfied: referencing&gt;=0.28.4 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat) (0.35.1)
Requirement already satisfied: rpds-py&gt;=0.7.1 in /Library/Frameworks/Python.framework/Versions/3.12/lib/python3.12/site-packages (from jsonschema&gt;=2.6-&gt;nbformat) (0.20.0)
Requirement already satisfied: platformdirs&gt;=2.5 in /Users/waelbenhamouda/Library/Python/3.12/lib/python/site-packages (from jupyter-core!=5.0.*,&gt;=4.12-&gt;nbformat) (4.2.2)

[notice] A new release of pip is available: 24.0 -&gt; 24.2
[notice] To update, run: pip3 install --upgrade pip
Note: you may need to restart the kernel to use updated packages.</code></pre>
</div>
</div>
<p><strong>Importing the needed packages</strong></p>
<div id="cell-22" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objs <span class="im">as</span> go</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> plotly.subplots <span class="im">import</span> make_subplots</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.io <span class="im">as</span> pio</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> PIL <span class="im">import</span> Image</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.offline <span class="im">as</span> pyo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="importing-the-datasets" class="level1">
<h1>IMPORTING THE DATASETS</h1>
<p><em>All our datasets are from the “INSEE” databank.</em></p>
<section id="loading-the-1st-round-elections-database" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-1st-round-elections-database">Loading the 1st round elections database</h2>
<div id="cell-26" class="cell" data-outputid="a8c6ca72-8351-44f1-ae7e-948bf2672efa" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> pd.read_excel(os.path.join(dir_data, <span class="st">"Presidentielle_2017_Resultats_Communes_Tour_1.xls"</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>elections.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Code du département</th>
<th data-quarto-table-cell-role="th">Libellé du département</th>
<th data-quarto-table-cell-role="th">Code de la commune</th>
<th data-quarto-table-cell-role="th">Libellé de la commune</th>
<th data-quarto-table-cell-role="th">Inscrits</th>
<th data-quarto-table-cell-role="th">Abstentions</th>
<th data-quarto-table-cell-role="th">% Abs/Ins</th>
<th data-quarto-table-cell-role="th">Votants</th>
<th data-quarto-table-cell-role="th">% Vot/Ins</th>
<th data-quarto-table-cell-role="th">Blancs</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Voix.9</th>
<th data-quarto-table-cell-role="th">% Voix/Ins.9</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.9</th>
<th data-quarto-table-cell-role="th">N°Panneau.10</th>
<th data-quarto-table-cell-role="th">Sexe.10</th>
<th data-quarto-table-cell-role="th">Nom.10</th>
<th data-quarto-table-cell-role="th">Prénom.10</th>
<th data-quarto-table-cell-role="th">Voix.10</th>
<th data-quarto-table-cell-role="th">% Voix/Ins.10</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Ain</td>
<td>1</td>
<td>L'Abergement-Clémenciat</td>
<td>598</td>
<td>92</td>
<td>15.38</td>
<td>506</td>
<td>84.62</td>
<td>2</td>
<td>...</td>
<td>2</td>
<td>0.33</td>
<td>0.40</td>
<td>8</td>
<td>M</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>2</td>
<td>0.33</td>
<td>0.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Ain</td>
<td>2</td>
<td>L'Abergement-de-Varey</td>
<td>209</td>
<td>25</td>
<td>11.96</td>
<td>184</td>
<td>88.04</td>
<td>6</td>
<td>...</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>8</td>
<td>M</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Ain</td>
<td>4</td>
<td>Ambérieu-en-Bugey</td>
<td>8586</td>
<td>1962</td>
<td>22.85</td>
<td>6624</td>
<td>77.15</td>
<td>114</td>
<td>...</td>
<td>40</td>
<td>0.47</td>
<td>0.62</td>
<td>7</td>
<td>M</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>5</td>
<td>0.06</td>
<td>0.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Ain</td>
<td>5</td>
<td>Ambérieux-en-Dombes</td>
<td>1172</td>
<td>215</td>
<td>18.34</td>
<td>957</td>
<td>81.66</td>
<td>21</td>
<td>...</td>
<td>5</td>
<td>0.43</td>
<td>0.54</td>
<td>7</td>
<td>M</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Ain</td>
<td>6</td>
<td>Ambléon</td>
<td>99</td>
<td>20</td>
<td>20.20</td>
<td>79</td>
<td>79.80</td>
<td>2</td>
<td>...</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>10</td>
<td>M</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>5 rows × 95 columns</p>
</div>
</div>
</div>
<p><strong>Find the name of the candidates :</strong></p>
<p><strong>-Nom : Candidate finishing 1st in the votings for a given commune</strong></p>
<p><strong>-Nom.1 : Candidate finishing 2nd in the votings for a given commune</strong></p>
<p><strong>-Nom.2 : Candidate finishing 3rd in the votings for a given commune</strong></p>
<div id="cell-28" class="cell" data-outputid="43b24346-c3cf-4f66-a918-183af599c07a" data-execution_count="14">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select the columns starting by "Nome"</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>colonnes_nom <span class="op">=</span> elections.<span class="bu">filter</span>(like<span class="op">=</span><span class="st">'Nom'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a set to store the unique names</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>noms_uniques <span class="op">=</span> <span class="bu">set</span>()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Storing the names in the set "nom_uniques"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> colonne <span class="kw">in</span> colonnes_nom.columns:</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    noms_uniques.update(elections[colonne].unique())</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the list of candidates without redundancies</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"List of candidates without redundancies :"</span>)</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(noms_uniques)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>List of candidates without redundancies :
{'ASSELINEAU', 'DUPONT-AIGNAN', 'MÉLENCHON', 'MACRON', 'LE PEN', 'HAMON', 'POUTOU', 'CHEMINADE', 'ARTHAUD', 'LASSALLE', 'FILLON'}</code></pre>
</div>
</div>
<p><em>There are 11 candidates participating to the 1st round of the 2017 France presidential elections</em></p>
<p><strong>Make sur that “Code de la commune” is a type object</strong></p>
<div id="cell-31" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> elections.astype({<span class="st">'Code de la commune'</span> : <span class="st">'object'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Create a signe commune identifier (called “CODGEO”) that is composed as follows :</strong></p>
<p><strong>The 2 first digits correspond to the “Code du département” number, and the 3 last digits correspond to the “Code de la commune” number.</strong></p>
<div id="cell-33" class="cell" data-outputid="9a0980e0-75a4-4ca6-ad31-4dea153c7d9a" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sur that "Code du département" and "Code de la commune are strings"</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">'Code du département'</span>] <span class="op">=</span> elections[<span class="st">'Code du département'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">'Code de la commune'</span>] <span class="op">=</span> elections[<span class="st">'Code de la commune'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Use .str.zfill(3) to add 0s if necessary</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">'CODGEO'</span>] <span class="op">=</span> elections[<span class="st">'Code du département'</span>] <span class="op">+</span> elections[<span class="st">'Code de la commune'</span>].<span class="bu">str</span>.zfill(<span class="dv">3</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>elections[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0    1001
1    1002
2    1004
3    1005
4    1006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
<div id="cell-34" class="cell" data-outputid="bf63116a-31e5-4ebf-b2cc-f5361642d1f9" data-execution_count="17">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>elections.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Code du département</th>
<th data-quarto-table-cell-role="th">Libellé du département</th>
<th data-quarto-table-cell-role="th">Code de la commune</th>
<th data-quarto-table-cell-role="th">Libellé de la commune</th>
<th data-quarto-table-cell-role="th">Inscrits</th>
<th data-quarto-table-cell-role="th">Abstentions</th>
<th data-quarto-table-cell-role="th">% Abs/Ins</th>
<th data-quarto-table-cell-role="th">Votants</th>
<th data-quarto-table-cell-role="th">% Vot/Ins</th>
<th data-quarto-table-cell-role="th">Blancs</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">% Voix/Ins.9</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.9</th>
<th data-quarto-table-cell-role="th">N°Panneau.10</th>
<th data-quarto-table-cell-role="th">Sexe.10</th>
<th data-quarto-table-cell-role="th">Nom.10</th>
<th data-quarto-table-cell-role="th">Prénom.10</th>
<th data-quarto-table-cell-role="th">Voix.10</th>
<th data-quarto-table-cell-role="th">% Voix/Ins.10</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.10</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>Ain</td>
<td>1</td>
<td>L'Abergement-Clémenciat</td>
<td>598</td>
<td>92</td>
<td>15.38</td>
<td>506</td>
<td>84.62</td>
<td>2</td>
<td>...</td>
<td>0.33</td>
<td>0.40</td>
<td>8</td>
<td>M</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>2</td>
<td>0.33</td>
<td>0.40</td>
<td>1001</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>Ain</td>
<td>2</td>
<td>L'Abergement-de-Varey</td>
<td>209</td>
<td>25</td>
<td>11.96</td>
<td>184</td>
<td>88.04</td>
<td>6</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>8</td>
<td>M</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>1002</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>Ain</td>
<td>4</td>
<td>Ambérieu-en-Bugey</td>
<td>8586</td>
<td>1962</td>
<td>22.85</td>
<td>6624</td>
<td>77.15</td>
<td>114</td>
<td>...</td>
<td>0.47</td>
<td>0.62</td>
<td>7</td>
<td>M</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>5</td>
<td>0.06</td>
<td>0.08</td>
<td>1004</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>Ain</td>
<td>5</td>
<td>Ambérieux-en-Dombes</td>
<td>1172</td>
<td>215</td>
<td>18.34</td>
<td>957</td>
<td>81.66</td>
<td>21</td>
<td>...</td>
<td>0.43</td>
<td>0.54</td>
<td>7</td>
<td>M</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>1005</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>Ain</td>
<td>6</td>
<td>Ambléon</td>
<td>99</td>
<td>20</td>
<td>20.20</td>
<td>79</td>
<td>79.80</td>
<td>2</td>
<td>...</td>
<td>0.00</td>
<td>0.00</td>
<td>10</td>
<td>M</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0</td>
<td>0.00</td>
<td>0.00</td>
<td>1006</td>
</tr>
</tbody>
</table>

<p>5 rows × 96 columns</p>
</div>
</div>
</div>
<p><strong>Lets keep the colmuns of interest</strong></p>
<div id="cell-36" class="cell" data-outputid="bf4084c0-3bfb-494b-93a7-5f1501b893e9" data-execution_count="18">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> elections.iloc[:,<span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">3</span>, <span class="dv">18</span>)) <span class="op">+</span> [<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">24</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">31</span>, <span class="dv">34</span>, <span class="dv">35</span>, <span class="dv">38</span>, <span class="dv">41</span>, <span class="dv">42</span>, <span class="dv">45</span>, <span class="dv">48</span>, <span class="dv">49</span>, <span class="dv">52</span>, <span class="dv">55</span>, <span class="dv">56</span>, <span class="dv">59</span>, <span class="dv">62</span>, <span class="dv">63</span>, <span class="dv">66</span>, <span class="dv">69</span>, <span class="dv">70</span>, <span class="dv">73</span>, <span class="dv">76</span>, <span class="dv">77</span>, <span class="dv">80</span>, <span class="dv">83</span>, <span class="dv">84</span>, <span class="dv">87</span>, <span class="dv">90</span>, <span class="dv">91</span>, <span class="dv">94</span>, <span class="dv">95</span>]]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(elections.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Libellé de la commune', 'Inscrits', 'Abstentions', '% Abs/Ins', 'Votants', '% Vot/Ins', 'Blancs', '% Blancs/Ins', '% Blancs/Vot', 'Nuls', '% Nuls/Ins', '% Nuls/Vot', 'Exprimés', '% Exp/Ins', '% Exp/Vot', 'Nom', 'Prénom', '% Voix/Exp', 'Nom.1', 'Prénom.1', '% Voix/Exp.1', 'Nom.2', 'Prénom.2', '% Voix/Exp.2', 'Nom.3', 'Prénom.3', '% Voix/Exp.3', 'Nom.4', 'Prénom.4', '% Voix/Exp.4', 'Nom.5', 'Prénom.5', '% Voix/Exp.5', 'Nom.6', 'Prénom.6', '% Voix/Exp.6', 'Nom.7', 'Prénom.7', '% Voix/Exp.7', 'Nom.8', 'Prénom.8', '% Voix/Exp.8', 'Nom.9', 'Prénom.9', '% Voix/Exp.9', 'Nom.10', 'Prénom.10', '% Voix/Exp.10', 'CODGEO']</code></pre>
</div>
</div>
<p><strong>Rename ‘Libellé de la commune’ into ‘LIBCOM’</strong></p>
<div id="cell-38" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> elections.rename(columns<span class="op">=</span>{<span class="st">'Libellé de la commune'</span> : <span class="st">'LIBCOM'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We put the “CODGEO” column in 1st position</strong></p>
<div id="cell-40" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of actual columns</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>colst <span class="op">=</span> elections.columns.tolist()</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Move a selected column (here 'LIB_MOD') to the first position</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>colst.insert(<span class="dv">0</span>, colst.pop(colst.index(<span class="st">'CODGEO'</span>)))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganise the columns</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>elections <span class="op">=</span> elections[colst]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-the-commune-population-database" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-commune-population-database">Loading the commune population database</h2>
<div id="cell-42" class="cell" data-outputid="14d094c4-6098-48fd-faf6-edc03448528f" data-execution_count="21">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>pop <span class="op">=</span> pd.read_excel(os.path.join(dir_data, <span class="st">"pop_2018.xlsx"</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>pop <span class="op">=</span> pop.iloc[<span class="dv">1</span>:,:]</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>pop.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">IRIS</th>
<th data-quarto-table-cell-role="th">Région</th>
<th data-quarto-table-cell-role="th">Département</th>
<th data-quarto-table-cell-role="th">Unité urbaine</th>
<th data-quarto-table-cell-role="th">Commune ou ARM</th>
<th data-quarto-table-cell-role="th">Libellé commune ou ARM</th>
<th data-quarto-table-cell-role="th">TRIRIS</th>
<th data-quarto-table-cell-role="th">Grand quartier</th>
<th data-quarto-table-cell-role="th">Libellé de l'IRIS</th>
<th data-quarto-table-cell-role="th">Type d'IRIS</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Femmes Prof. intermédiaires en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Femmes Employés en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Femmes Ouvriers en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Femmes Retraités en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Femmes Autres en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop Français en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop Etrangers en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop Immigrés en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop ménages en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop hors ménages en 2018 (princ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1</td>
<td>010010000</td>
<td>84</td>
<td>01</td>
<td>01000</td>
<td>01001</td>
<td>L'Abergement-Clémenciat</td>
<td>ZZZZZZ</td>
<td>0100100</td>
<td>L'Abergement-Clémenciat (commune non irisée)</td>
<td>Z</td>
<td>...</td>
<td>50.822045</td>
<td>84.918772</td>
<td>30.310146</td>
<td>72.228685</td>
<td>15.109943</td>
<td>762.887419</td>
<td>8.112581</td>
<td>20.218899</td>
<td>771</td>
<td>0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>010020000</td>
<td>84</td>
<td>01</td>
<td>01000</td>
<td>01002</td>
<td>L'Abergement-de-Varey</td>
<td>ZZZZZZ</td>
<td>0100200</td>
<td>L'Abergement-de-Varey (commune non irisée)</td>
<td>Z</td>
<td>...</td>
<td>20.823045</td>
<td>26.028807</td>
<td>0</td>
<td>20.823045</td>
<td>0</td>
<td>250.917695</td>
<td>2.082305</td>
<td>3.123457</td>
<td>253.0</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3</td>
<td>010040101</td>
<td>84</td>
<td>01</td>
<td>01303</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>ZZZZZZ</td>
<td>0100401</td>
<td>Les Pérouses-Triangle d'Activités</td>
<td>H</td>
<td>...</td>
<td>99.467158</td>
<td>233.634262</td>
<td>60.514637</td>
<td>179.126566</td>
<td>187.751279</td>
<td>1639.715923</td>
<td>272.964221</td>
<td>258.055838</td>
<td>1552.119901</td>
<td>360.560242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>010040102</td>
<td>84</td>
<td>01</td>
<td>01303</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>ZZZZZZ</td>
<td>0100401</td>
<td>Longeray-Gare</td>
<td>H</td>
<td>...</td>
<td>220.197642</td>
<td>392.261556</td>
<td>153.900641</td>
<td>373.799935</td>
<td>329.796115</td>
<td>3119.279467</td>
<td>469.040863</td>
<td>577.961963</td>
<td>3588.32033</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>010040201</td>
<td>84</td>
<td>01</td>
<td>01303</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>ZZZZZZ</td>
<td>0100402</td>
<td>Centre-Saint-Germain-Vareilles</td>
<td>H</td>
<td>...</td>
<td>252.224837</td>
<td>378.597055</td>
<td>193.208604</td>
<td>511.346325</td>
<td>371.510022</td>
<td>3811.121391</td>
<td>369.299423</td>
<td>428.831322</td>
<td>4092.41967</td>
<td>88.001144</td>
</tr>
</tbody>
</table>

<p>5 rows × 84 columns</p>
</div>
</div>
</div>
<p><strong>Keeping the variables of interest</strong></p>
<div id="cell-44" class="cell" data-outputid="50e50d11-16b8-4a21-a4cd-9b332cab0f76" data-execution_count="22">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>pop <span class="op">=</span> pop.iloc[:, [<span class="dv">0</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">12</span>] <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">17</span>, <span class="dv">23</span>)) <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">53</span>, <span class="dv">60</span>))]</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(pop.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>['IRIS',
 'Commune ou ARM',
 'Libellé commune ou ARM',
 'Population en 2018 (princ)',
 'Pop 18-24 ans en 2018 (princ)',
 'Pop 25-39 ans en 2018 (princ)',
 'Pop 40-54 ans en 2018 (princ)',
 'Pop 55-64 ans en 2018 (princ)',
 'Pop 65-79 ans en 2018 (princ)',
 'Pop 80 ans ou plus en 2018 (princ)',
 'Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)',
 'Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)',
 'Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)',
 'Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)',
 'Pop 15 ans ou plus Employés en 2018 (compl)',
 'Pop 15 ans ou plus Ouvriers en 2018 (compl)',
 'Pop 15 ans ou plus Retraités en 2018 (compl)']</code></pre>
</div>
</div>
<p>Delete the 0 at the begenning of the “Commune ou ARM” modalities</p>
<div id="cell-46" class="cell" data-outputid="f2fa04bc-4748-4785-e81f-cea97eefaffa" data-execution_count="23">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>pop[<span class="st">'Commune ou ARM'</span>] <span class="op">=</span> pop[<span class="st">'Commune ou ARM'</span>].<span class="bu">str</span>.replace(<span class="st">'^0+'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>pop[<span class="st">'Commune ou ARM'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>1    1001
2    1002
3    1004
4    1004
5    1004
Name: Commune ou ARM, dtype: object</code></pre>
</div>
</div>
<p>Convert the population variables in numeric</p>
<div id="cell-48" class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Store the variables to convert</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>columns_to_convert <span class="op">=</span> [</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Population en 2018 (princ)'</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 18-24 ans en 2018 (princ)'</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 25-39 ans en 2018 (princ)'</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 40-54 ans en 2018 (princ)'</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 55-64 ans en 2018 (princ)'</span>,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 65-79 ans en 2018 (princ)'</span>,</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 80 ans ou plus en 2018 (princ)'</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)'</span>,</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)'</span>,</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)'</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)'</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Employés en 2018 (compl)'</span>,</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Ouvriers en 2018 (compl)'</span>,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pop 15 ans ou plus Retraités en 2018 (compl)'</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># We convert the variables stored in "columns_to_convert"</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>pop <span class="op">=</span> pop.astype({column: <span class="st">'float'</span> <span class="cf">for</span> column <span class="kw">in</span> columns_to_convert})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Convert the ‘IRIS’, ‘Commune ou ARM’ and ‘Libellé commune ou ARM’ in string</strong></p>
<div id="cell-50" class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>pop <span class="op">=</span> pop.astype({<span class="st">'IRIS'</span>:<span class="st">'object'</span>, <span class="st">'Commune ou ARM'</span>:<span class="st">'object'</span>, <span class="st">'Libellé commune ou ARM'</span>:<span class="st">'object'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We group observations by ‘Commune ou ARM’ and compute the sum of IRIS population for each commune and each variable (in order to get the population of every single commune and every single variable).</strong></p>
<div id="cell-52" class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_pop <span class="op">=</span> pop.groupby([<span class="st">'Commune ou ARM'</span>, <span class="st">'Libellé commune ou ARM'</span>]).<span class="bu">sum</span>(numeric_only<span class="op">=</span><span class="va">True</span>).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>In order to compute the total labor force population, we first store the variables of interest in the “var_sum” database</strong></p>
<div id="cell-54" class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>var_sum <span class="op">=</span> df_pop[[<span class="st">'Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)'</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)'</span>,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)'</span>,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)'</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Employés en 2018 (compl)'</span>,</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Ouvriers en 2018 (compl)'</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Retraités en 2018 (compl)'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We compute the total labor force population</strong></p>
<div id="cell-56" class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df_pop[<span class="st">'Pop plus 15 ans actifs'</span>] <span class="op">=</span> var_sum.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Instead of having a population (for each variable) counted in unit of inhabitants, we want it to be a percentage of the total labor force population in the commune.</strong></p>
<div id="cell-58" class="cell" data-outputid="8f6fea76-3b6c-454f-a72a-c34e13803188" data-execution_count="29">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> [<span class="st">'Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)'</span>,</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)'</span>,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)'</span>,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Employés en 2018 (compl)'</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Ouvriers en 2018 (compl)'</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">'Pop 15 ans ou plus Retraités en 2018 (compl)'</span>]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide each column by 'Pop plus 15 ans actifs'</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>df_pop[var] <span class="op">=</span> df_pop[var].div(df_pop[<span class="st">'Pop plus 15 ans actifs'</span>], axis<span class="op">=</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the dataframe to check</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>df_pop[var].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Employés en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Ouvriers en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop 15 ans ou plus Retraités en 2018 (compl)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.000000</td>
<td>2.777778</td>
<td>5.555556</td>
<td>13.888889</td>
<td>25.000000</td>
<td>19.444444</td>
<td>33.333333</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.195913</td>
<td>4.190272</td>
<td>6.386902</td>
<td>10.968750</td>
<td>15.159007</td>
<td>16.759922</td>
<td>45.339234</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21.899274</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.170271</td>
<td>18.703766</td>
<td>25.056902</td>
<td>31.169787</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.000000</td>
<td>4.761905</td>
<td>9.523810</td>
<td>16.666667</td>
<td>19.047619</td>
<td>14.285714</td>
<td>35.714286</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.256937</td>
<td>2.826302</td>
<td>4.624857</td>
<td>8.992778</td>
<td>21.325731</td>
<td>18.242493</td>
<td>43.730903</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>We rename the columns using the prefixe “Pourcentage”</strong></p>
<div id="cell-60" class="cell" data-outputid="1a70ca43-ce87-4708-ee87-090f67c5fce7" data-execution_count="30">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns using the prefixe "Pourcentage"</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>df_pop.rename(columns<span class="op">=</span>{col: <span class="ss">f"Pourcentage </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> col <span class="kw">in</span> var}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the list of columns</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(df_pop.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Commune ou ARM', 'Libellé commune ou ARM', 'Population en 2018 (princ)', 'Pop 18-24 ans en 2018 (princ)', 'Pop 25-39 ans en 2018 (princ)', 'Pop 40-54 ans en 2018 (princ)', 'Pop 55-64 ans en 2018 (princ)', 'Pop 65-79 ans en 2018 (princ)', 'Pop 80 ans ou plus en 2018 (princ)', 'Pourcentage Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Employés en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Ouvriers en 2018 (compl)', 'Pourcentage Pop 15 ans ou plus Retraités en 2018 (compl)', 'Pop plus 15 ans actifs']</code></pre>
</div>
</div>
<p><strong>Rename “Libellé commune ou ARM” into “Libellé de la commune” and “Commune ou ARM” into “CODGEO”</strong></p>
<div id="cell-62" class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_pop <span class="op">=</span> df_pop.rename(columns<span class="op">=</span>{<span class="st">'Libellé commune ou ARM'</span>:<span class="st">'LIBCOM'</span>})</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_pop <span class="op">=</span> df_pop.rename(columns<span class="op">=</span>{<span class="st">'Commune ou ARM'</span> : <span class="st">'CODGEO'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>As before, in order to compute the total population of 18 years old people and older, we first store the variables of interest in the “var_sum_1” database.</strong></p>
<div id="cell-64" class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>var_sum_1 <span class="op">=</span> df_pop[[<span class="st">'Pop 18-24 ans en 2018 (princ)'</span>,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 25-39 ans en 2018 (princ)'</span>,</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 40-54 ans en 2018 (princ)'</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 55-64 ans en 2018 (princ)'</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 65-79 ans en 2018 (princ)'</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 80 ans ou plus en 2018 (princ)'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Compute the population of 18 years old people and older</strong></p>
<div id="cell-66" class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_pop[<span class="st">'Pop plus 18 ans'</span>] <span class="op">=</span> var_sum_1.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Instead of having a population (for each variable) counted in unit of inhabitants, we want to make it as a percentage of the 18 years old and older population in the commune.</strong></p>
<div id="cell-68" class="cell" data-outputid="b0beb9d2-fbc8-4052-b8c2-0448e20efef5" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>var_1 <span class="op">=</span> [<span class="st">'Pop 18-24 ans en 2018 (princ)'</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 25-39 ans en 2018 (princ)'</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 40-54 ans en 2018 (princ)'</span>,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 55-64 ans en 2018 (princ)'</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 65-79 ans en 2018 (princ)'</span>,</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">'Pop 80 ans ou plus en 2018 (princ)'</span>]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide each column by 'Pop plus 18 ans'</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>df_pop[var_1] <span class="op">=</span> df_pop[var_1].div(df_pop[<span class="st">'Pop plus 18 ans'</span>], axis<span class="op">=</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the dataframe to check</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>df_pop[var_1].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pop 18-24 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop 25-39 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop 40-54 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop 55-64 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop 65-79 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pop 80 ans ou plus en 2018 (princ)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>6.666667</td>
<td>13.846154</td>
<td>28.205128</td>
<td>20.512821</td>
<td>23.076923</td>
<td>7.692308</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>6.760350</td>
<td>17.993317</td>
<td>23.832830</td>
<td>16.047134</td>
<td>24.112197</td>
<td>11.254172</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>8.937512</td>
<td>26.840907</td>
<td>21.703720</td>
<td>17.769576</td>
<td>17.780119</td>
<td>6.968166</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>3.448276</td>
<td>18.226601</td>
<td>27.586207</td>
<td>21.674877</td>
<td>19.704433</td>
<td>9.359606</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10.491801</td>
<td>19.787565</td>
<td>20.416897</td>
<td>14.085581</td>
<td>22.307513</td>
<td>12.910643</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-69" class="cell" data-outputid="fdbde844-fcd4-4a2c-d7e7-08807934ba32" data-execution_count="35">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the colomns by adding the prefixe "Pourcentage"</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_pop.rename(columns<span class="op">=</span>{col: <span class="ss">f"Pourcentage </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> col <span class="kw">in</span> var_1}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>df_pop.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="35">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">Population en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 18-24 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 25-39 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 40-54 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 55-64 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 65-79 ans en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 80 ans ou plus en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Employés en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Ouvriers en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Retraités en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop plus 15 ans actifs</th>
<th data-quarto-table-cell-role="th">Pop plus 18 ans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>10002</td>
<td>Ailleville</td>
<td>244.0</td>
<td>6.666667</td>
<td>13.846154</td>
<td>28.205128</td>
<td>20.512821</td>
<td>23.076923</td>
<td>7.692308</td>
<td>0.000000</td>
<td>2.777778</td>
<td>5.555556</td>
<td>13.888889</td>
<td>25.000000</td>
<td>19.444444</td>
<td>33.333333</td>
<td>185.316456</td>
<td>200.759494</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>10003</td>
<td>Aix-Villemaur-Pâlis</td>
<td>3547.0</td>
<td>6.760350</td>
<td>17.993317</td>
<td>23.832830</td>
<td>16.047134</td>
<td>24.112197</td>
<td>11.254172</td>
<td>1.195913</td>
<td>4.190272</td>
<td>6.386902</td>
<td>10.968750</td>
<td>15.159007</td>
<td>16.759922</td>
<td>45.339234</td>
<td>2501.329399</td>
<td>2788.718721</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>10004</td>
<td>Allibaudières</td>
<td>207.0</td>
<td>8.937512</td>
<td>26.840907</td>
<td>21.703720</td>
<td>17.769576</td>
<td>17.780119</td>
<td>6.968166</td>
<td>21.899274</td>
<td>0.000000</td>
<td>0.000000</td>
<td>3.170271</td>
<td>18.703766</td>
<td>25.056902</td>
<td>31.169787</td>
<td>158.412194</td>
<td>155.212399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>10005</td>
<td>Amance</td>
<td>265.0</td>
<td>3.448276</td>
<td>18.226601</td>
<td>27.586207</td>
<td>21.674877</td>
<td>19.704433</td>
<td>9.359606</td>
<td>0.000000</td>
<td>4.761905</td>
<td>9.523810</td>
<td>16.666667</td>
<td>19.047619</td>
<td>14.285714</td>
<td>35.714286</td>
<td>218.235294</td>
<td>210.960784</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>10006</td>
<td>Arcis-sur-Aube</td>
<td>2839.0</td>
<td>10.491801</td>
<td>19.787565</td>
<td>20.416897</td>
<td>14.085581</td>
<td>22.307513</td>
<td>12.910643</td>
<td>0.256937</td>
<td>2.826302</td>
<td>4.624857</td>
<td>8.992778</td>
<td>21.325731</td>
<td>18.242493</td>
<td>43.730903</td>
<td>1995.527734</td>
<td>2285.258140</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="loading-the-commune-education-level-database" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-commune-education-level-database">Loading the commune education level database</h2>
<div id="cell-71" class="cell" data-outputid="d790d68e-82b0-4d51-f2c5-8a41777ba6ba" data-execution_count="36">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>educ <span class="op">=</span> pd.read_csv(os.path.join(dir_data, <span class="st">"base-cc-diplomes-formation-2017.CSV"</span>), delimiter<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/wq/gdm35j4d57x4n3phrgxl26yc0000gn/T/ipykernel_2197/2393584669.py:1: DtypeWarning:

Columns (0) have mixed types. Specify dtype option on import or set low_memory=False.
</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">P17_POP0205</th>
<th data-quarto-table-cell-role="th">P17_POP0610</th>
<th data-quarto-table-cell-role="th">P17_POP1114</th>
<th data-quarto-table-cell-role="th">P17_POP1517</th>
<th data-quarto-table-cell-role="th">P17_POP1824</th>
<th data-quarto-table-cell-role="th">P17_POP2529</th>
<th data-quarto-table-cell-role="th">P17_POP30P</th>
<th data-quarto-table-cell-role="th">P17_SCOL0205</th>
<th data-quarto-table-cell-role="th">P17_SCOL0610</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">P07_HNSCOL15P_BACP2</th>
<th data-quarto-table-cell-role="th">P07_HNSCOL15P_SUP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_DIPL0</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_CEP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BEPC</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_CAPBEP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BAC</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BACP2</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_SUP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>25.124266</td>
<td>57.197304</td>
<td>57.154124</td>
<td>33.181349</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>17.052683</td>
<td>55.179421</td>
<td>...</td>
<td>26.777228</td>
<td>26.777228</td>
<td>268.764034</td>
<td>42.645216</td>
<td>52.562708</td>
<td>11.900990</td>
<td>57.521454</td>
<td>46.612212</td>
<td>37.686470</td>
<td>19.834984</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>16.329218</td>
<td>14.288066</td>
<td>17.349794</td>
<td>7.144033</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>11.226337</td>
<td>14.288066</td>
<td>...</td>
<td>9.831898</td>
<td>10.815088</td>
<td>63.907336</td>
<td>2.949569</td>
<td>10.815088</td>
<td>2.949569</td>
<td>11.798277</td>
<td>15.731036</td>
<td>7.865518</td>
<td>11.798277</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>711.860945</td>
<td>925.738397</td>
<td>671.149507</td>
<td>593.927796</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>511.560269</td>
<td>915.826571</td>
<td>...</td>
<td>521.301673</td>
<td>331.170482</td>
<td>4805.326049</td>
<td>936.823732</td>
<td>772.857734</td>
<td>325.105241</td>
<td>1140.240216</td>
<td>756.861255</td>
<td>537.488941</td>
<td>335.948929</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>96.866831</td>
<td>120.651437</td>
<td>88.244742</td>
<td>59.940064</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>70.043605</td>
<td>117.574485</td>
<td>...</td>
<td>56.753020</td>
<td>33.195163</td>
<td>525.768542</td>
<td>107.081170</td>
<td>91.018994</td>
<td>44.974091</td>
<td>118.860098</td>
<td>72.815195</td>
<td>59.965455</td>
<td>31.053539</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>1.009091</td>
<td>3.027273</td>
<td>5.045455</td>
<td>3.027273</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>1.009091</td>
<td>3.027273</td>
<td>...</td>
<td>2.089848</td>
<td>8.359393</td>
<td>49.111436</td>
<td>8.359393</td>
<td>9.404318</td>
<td>6.269545</td>
<td>6.269545</td>
<td>7.314469</td>
<td>6.269545</td>
<td>5.224621</td>
</tr>
</tbody>
</table>

<p>5 rows × 199 columns</p>
</div>
</div>
</div>
<p><em>We can see that the labels of the variables are not put and same for the communes labels. Then, we will create geo code and variable label databases in order to make our educ dataset clearer (replacing the codes by their labels).</em></p>
</section>
<section id="creating-the-geo-code-and-variable-label-databases" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-geo-code-and-variable-label-databases">Creating the geo code and variable label databases</h2>
<p><strong>Loading the codes and corresponding labels of the education database variables</strong></p>
<div id="cell-75" class="cell" data-outputid="2922e722-2c35-42a0-ed46-ed5d59c644e4" data-execution_count="37">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>educ_code <span class="op">=</span> pd.read_csv(os.path.join(dir_data, <span class="st">"meta_base-cc-diplomes-formation-2017.CSV"</span>), delimiter<span class="op">=</span><span class="st">";"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>educ_code.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COD_VAR</th>
<th data-quarto-table-cell-role="th">LIB_VAR</th>
<th data-quarto-table-cell-role="th">LIB_VAR_LONG</th>
<th data-quarto-table-cell-role="th">COD_MOD</th>
<th data-quarto-table-cell-role="th">LIB_MOD</th>
<th data-quarto-table-cell-role="th">TYPE_VAR</th>
<th data-quarto-table-cell-role="th">LONG_VAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>P17_POP0205</td>
<td>Pop 2-5 ans en 2017 (princ)</td>
<td>Nombre de personnes de 2 à 5 ans en 2017</td>
<td>NaN</td>
<td>NaN</td>
<td>NUM</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>P17_POP0610</td>
<td>Pop 6-10 ans en 2017 (princ)</td>
<td>Nombre de personnes de 6 à 10 ans en 2017</td>
<td>NaN</td>
<td>NaN</td>
<td>NUM</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>P17_POP1114</td>
<td>Pop 11-14 ans en 2017 (princ)</td>
<td>Nombre de personnes de 11 à 14 ans en 2017</td>
<td>NaN</td>
<td>NaN</td>
<td>NUM</td>
<td>17</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>P17_POP1517</td>
<td>Pop 15-17 ans en 2017 (princ)</td>
<td>Nombre de personnes de 15 à 17 ans en 2017</td>
<td>NaN</td>
<td>NaN</td>
<td>NUM</td>
<td>17</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>P17_POP1824</td>
<td>Pop 18-24 ans en 2017 (princ)</td>
<td>Nombre de personnes de 18 à 24 ans en 2017</td>
<td>NaN</td>
<td>NaN</td>
<td>NUM</td>
<td>17</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Where do the CODGEO labels start from ?</strong></p>
<div id="cell-77" class="cell" data-outputid="14d9bd1c-95a7-4133-dbd8-1900c63494d8" data-execution_count="38">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>educ_code.loc[(educ_code[<span class="st">'COD_VAR'</span>].<span class="bu">str</span>.startswith(<span class="st">'CODGEO'</span>)),:].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COD_VAR</th>
<th data-quarto-table-cell-role="th">LIB_VAR</th>
<th data-quarto-table-cell-role="th">LIB_VAR_LONG</th>
<th data-quarto-table-cell-role="th">COD_MOD</th>
<th data-quarto-table-cell-role="th">LIB_MOD</th>
<th data-quarto-table-cell-role="th">TYPE_VAR</th>
<th data-quarto-table-cell-role="th">LONG_VAR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">198</td>
<td>CODGEO</td>
<td>Code commune</td>
<td>Code commune</td>
<td>01001</td>
<td>L'Abergement-Clémenciat</td>
<td>CHAR</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">199</td>
<td>CODGEO</td>
<td>Code commune</td>
<td>Code commune</td>
<td>01002</td>
<td>L'Abergement-de-Varey</td>
<td>CHAR</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">200</td>
<td>CODGEO</td>
<td>Code commune</td>
<td>Code commune</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>CHAR</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">201</td>
<td>CODGEO</td>
<td>Code commune</td>
<td>Code commune</td>
<td>01005</td>
<td>Ambérieux-en-Dombes</td>
<td>CHAR</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">202</td>
<td>CODGEO</td>
<td>Code commune</td>
<td>Code commune</td>
<td>01006</td>
<td>Ambléon</td>
<td>CHAR</td>
<td>5</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><em>It starts from the raw 198.</em></p>
<p><strong>Lets keep the lines from the raw 198 to the end</strong></p>
<div id="cell-80" class="cell" data-outputid="2ed4813d-9432-4aa0-d777-9cae0f687ffd" data-execution_count="39">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>geo_code <span class="op">=</span> educ_code.iloc[<span class="dv">198</span>:,[<span class="dv">3</span>,<span class="dv">4</span>]]</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(geo_code.head())</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(geo_code.tail())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    COD_MOD                  LIB_MOD
198   01001  L'Abergement-Clémenciat
199   01002    L'Abergement-de-Varey
200   01004        Ambérieu-en-Bugey
201   01005      Ambérieux-en-Dombes
202   01006                  Ambléon
      COD_MOD            LIB_MOD
35189   97420     Sainte-Suzanne
35190   97421            Salazie
35191   97422          Le Tampon
35192   97423  Les Trois-Bassins
35193   97424             Cilaos</code></pre>
</div>
</div>
<p><strong>Rename the ‘COD_MOD’ variable into ‘CODGEO’ in the geo code database</strong></p>
<div id="cell-82" class="cell" data-outputid="2c4d6396-9d90-4123-ebfc-1e9d39fa1122" data-execution_count="40">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>geo_code <span class="op">=</span> geo_code.rename(columns<span class="op">=</span>{<span class="st">'COD_MOD'</span>:<span class="st">'CODGEO'</span>})</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>geo_code[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>198    01001
199    01002
200    01004
201    01005
202    01006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
<p><strong>Taking off the 0s located in first positions</strong></p>
<div id="cell-84" class="cell" data-outputid="e159e5ed-68b5-471a-ffd5-99528757008f" data-execution_count="41">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>geo_code[<span class="st">'CODGEO'</span>] <span class="op">=</span> geo_code[<span class="st">'CODGEO'</span>].<span class="bu">str</span>.replace(<span class="st">'^0+'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>geo_code[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>198    1001
199    1002
200    1004
201    1005
202    1006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
<p><strong>We reset the index to 0</strong></p>
<div id="cell-86" class="cell" data-outputid="db03c81e-a475-48f6-b2bb-bb2f7e2adff5" data-execution_count="42">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>geo_code.reset_index(drop<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>geo_code[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>0    1001
1    1002
2    1004
3    1005
4    1006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
</section>
<section id="creating-the-variable-label-database" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-variable-label-database">Creating the variable label database</h2>
<p><em>We create this database in order to replace the variable codes by their labels</em></p>
<p><strong>We select the 197 first lines for the variable label databse</strong></p>
<div id="cell-90" class="cell" data-outputid="2e3adcec-ac59-4475-fbf9-56cfad2e9334" data-execution_count="43">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>var_lab <span class="op">=</span> educ_code.iloc[<span class="dv">0</span>:<span class="dv">198</span>,[<span class="dv">0</span>,<span class="dv">2</span>]]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>var_lab.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">COD_VAR</th>
<th data-quarto-table-cell-role="th">LIB_VAR_LONG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>P17_POP0205</td>
<td>Nombre de personnes de 2 à 5 ans en 2017</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>P17_POP0610</td>
<td>Nombre de personnes de 6 à 10 ans en 2017</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>P17_POP1114</td>
<td>Nombre de personnes de 11 à 14 ans en 2017</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>P17_POP1517</td>
<td>Nombre de personnes de 15 à 17 ans en 2017</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>P17_POP1824</td>
<td>Nombre de personnes de 18 à 24 ans en 2017</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="merging-the-educ-and-geo_code-databases-in-order-to-get-the-corresponding-labels-of-the-communes-codes" class="level2">
<h2 class="anchored" data-anchor-id="merging-the-educ-and-geo_code-databases-in-order-to-get-the-corresponding-labels-of-the-communes-codes">Merging the educ and geo_code databases in order to get the corresponding labels of the ‘communes’ codes</h2>
<p><strong>We make sur that the column ‘CODGEO’ for both educ and geo_code datasets are strings</strong></p>
<div id="cell-93" class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>educ[<span class="st">'CODGEO'</span>] <span class="op">=</span> educ[<span class="st">'CODGEO'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>geo_code[<span class="st">'CODGEO'</span>] <span class="op">=</span> geo_code[<span class="st">'CODGEO'</span>].astype(<span class="bu">str</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Merge the geo code database to the educ database</strong></p>
<div id="cell-95" class="cell" data-outputid="fe5deb81-26a6-4b56-9f7d-f13d40bbdac4" data-execution_count="45">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_educ <span class="op">=</span> pd.merge(educ,geo_code, how <span class="op">=</span><span class="st">'inner'</span> , on<span class="op">=</span><span class="st">'CODGEO'</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>df_educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">P17_POP0205</th>
<th data-quarto-table-cell-role="th">P17_POP0610</th>
<th data-quarto-table-cell-role="th">P17_POP1114</th>
<th data-quarto-table-cell-role="th">P17_POP1517</th>
<th data-quarto-table-cell-role="th">P17_POP1824</th>
<th data-quarto-table-cell-role="th">P17_POP2529</th>
<th data-quarto-table-cell-role="th">P17_POP30P</th>
<th data-quarto-table-cell-role="th">P17_SCOL0205</th>
<th data-quarto-table-cell-role="th">P17_SCOL0610</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">P07_HNSCOL15P_SUP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_DIPL0</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_CEP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BEPC</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_CAPBEP</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BAC</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_BACP2</th>
<th data-quarto-table-cell-role="th">P07_FNSCOL15P_SUP</th>
<th data-quarto-table-cell-role="th">LIB_MOD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>25.124266</td>
<td>57.197304</td>
<td>57.154124</td>
<td>33.181349</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>17.052683</td>
<td>55.179421</td>
<td>...</td>
<td>26.777228</td>
<td>268.764034</td>
<td>42.645216</td>
<td>52.562708</td>
<td>11.900990</td>
<td>57.521454</td>
<td>46.612212</td>
<td>37.686470</td>
<td>19.834984</td>
<td>L'Abergement-Clémenciat</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>16.329218</td>
<td>14.288066</td>
<td>17.349794</td>
<td>7.144033</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>11.226337</td>
<td>14.288066</td>
<td>...</td>
<td>10.815088</td>
<td>63.907336</td>
<td>2.949569</td>
<td>10.815088</td>
<td>2.949569</td>
<td>11.798277</td>
<td>15.731036</td>
<td>7.865518</td>
<td>11.798277</td>
<td>L'Abergement-de-Varey</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>711.860945</td>
<td>925.738397</td>
<td>671.149507</td>
<td>593.927796</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>511.560269</td>
<td>915.826571</td>
<td>...</td>
<td>331.170482</td>
<td>4805.326049</td>
<td>936.823732</td>
<td>772.857734</td>
<td>325.105241</td>
<td>1140.240216</td>
<td>756.861255</td>
<td>537.488941</td>
<td>335.948929</td>
<td>Ambérieu-en-Bugey</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>96.866831</td>
<td>120.651437</td>
<td>88.244742</td>
<td>59.940064</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>70.043605</td>
<td>117.574485</td>
<td>...</td>
<td>33.195163</td>
<td>525.768542</td>
<td>107.081170</td>
<td>91.018994</td>
<td>44.974091</td>
<td>118.860098</td>
<td>72.815195</td>
<td>59.965455</td>
<td>31.053539</td>
<td>Ambérieux-en-Dombes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>1.009091</td>
<td>3.027273</td>
<td>5.045455</td>
<td>3.027273</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>1.009091</td>
<td>3.027273</td>
<td>...</td>
<td>8.359393</td>
<td>49.111436</td>
<td>8.359393</td>
<td>9.404318</td>
<td>6.269545</td>
<td>6.269545</td>
<td>7.314469</td>
<td>6.269545</td>
<td>5.224621</td>
<td>Ambléon</td>
</tr>
</tbody>
</table>

<p>5 rows × 200 columns</p>
</div>
</div>
</div>
</section>
<section id="rename-the-variables-of-the-df_educ-database" class="level2">
<h2 class="anchored" data-anchor-id="rename-the-variables-of-the-df_educ-database">Rename the variables of the df_educ database</h2>
<p><strong>Create a disctionnary to make the variable labels (stored in var_lab) corresponding to the variables codes (also stored in var_lab)</strong></p>
<div id="cell-98" class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>var_mapping <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(var_lab[<span class="st">'COD_VAR'</span>], var_lab[<span class="st">'LIB_VAR_LONG'</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Rename the columns of df_educ using the dictionnary created above. We only rename the columns corresponding to the variable codes available in df_educ.</strong></p>
<div id="cell-100" class="cell" data-outputid="bfb20fda-b464-427b-e890-5b7d6f402bf5" data-execution_count="47">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_educ.rename(columns<span class="op">=</span>var_mapping, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>df_educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 2 à 5 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 6 à 10 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 11 à 14 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 15 à 17 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes scolarisées de 2 à 5 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes scolarisées de 6 à 10 ans en 2017</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires du certificat d'études primaires en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2007</th>
<th data-quarto-table-cell-role="th">Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2007</th>
<th data-quarto-table-cell-role="th">LIB_MOD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>25.124266</td>
<td>57.197304</td>
<td>57.154124</td>
<td>33.181349</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>17.052683</td>
<td>55.179421</td>
<td>...</td>
<td>26.777228</td>
<td>268.764034</td>
<td>42.645216</td>
<td>52.562708</td>
<td>11.900990</td>
<td>57.521454</td>
<td>46.612212</td>
<td>37.686470</td>
<td>19.834984</td>
<td>L'Abergement-Clémenciat</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>16.329218</td>
<td>14.288066</td>
<td>17.349794</td>
<td>7.144033</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>11.226337</td>
<td>14.288066</td>
<td>...</td>
<td>10.815088</td>
<td>63.907336</td>
<td>2.949569</td>
<td>10.815088</td>
<td>2.949569</td>
<td>11.798277</td>
<td>15.731036</td>
<td>7.865518</td>
<td>11.798277</td>
<td>L'Abergement-de-Varey</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>711.860945</td>
<td>925.738397</td>
<td>671.149507</td>
<td>593.927796</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>511.560269</td>
<td>915.826571</td>
<td>...</td>
<td>331.170482</td>
<td>4805.326049</td>
<td>936.823732</td>
<td>772.857734</td>
<td>325.105241</td>
<td>1140.240216</td>
<td>756.861255</td>
<td>537.488941</td>
<td>335.948929</td>
<td>Ambérieu-en-Bugey</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>96.866831</td>
<td>120.651437</td>
<td>88.244742</td>
<td>59.940064</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>70.043605</td>
<td>117.574485</td>
<td>...</td>
<td>33.195163</td>
<td>525.768542</td>
<td>107.081170</td>
<td>91.018994</td>
<td>44.974091</td>
<td>118.860098</td>
<td>72.815195</td>
<td>59.965455</td>
<td>31.053539</td>
<td>Ambérieux-en-Dombes</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>1.009091</td>
<td>3.027273</td>
<td>5.045455</td>
<td>3.027273</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>1.009091</td>
<td>3.027273</td>
<td>...</td>
<td>8.359393</td>
<td>49.111436</td>
<td>8.359393</td>
<td>9.404318</td>
<td>6.269545</td>
<td>6.269545</td>
<td>7.314469</td>
<td>6.269545</td>
<td>5.224621</td>
<td>Ambléon</td>
</tr>
</tbody>
</table>

<p>5 rows × 200 columns</p>
</div>
</div>
</div>
<p><strong>Arrange the order of the columns and rename the column ‘LIB_MOD’ to “LIBCOM”</strong></p>
<div id="cell-102" class="cell" data-outputid="d4fda623-2424-4cf8-bd91-d2ad32a41ae8" data-execution_count="48">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of actual columns</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>cols <span class="op">=</span> df_educ.columns.tolist()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Move a selected column (here 'LIB_MOD') to the first position</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>cols.insert(<span class="dv">0</span>, cols.pop(cols.index(<span class="st">'LIB_MOD'</span>)))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorganise the columns</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>df_educ <span class="op">=</span> df_educ[cols]</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the column 'LIB_MOD' to "LIBCOM"</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>df_educ <span class="op">=</span> df_educ.rename(columns<span class="op">=</span>{<span class="st">'LIB_MOD'</span>:<span class="st">'LIBCOM'</span>})</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(df_educ.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['LIBCOM', 'CODGEO', 'Nombre de personnes de 2 à 5 ans en 2017', 'Nombre de personnes de 6 à 10 ans en 2017', 'Nombre de personnes de 11 à 14 ans en 2017', 'Nombre de personnes de 15 à 17 ans en 2017', 'Nombre de personnes de 18 à 24 ans en 2017', 'Nombre de personnes de 25 à 29 ans en 2017', 'Nombre de personnes de 30 ans ou plus en 2017', 'Nombre de personnes scolarisées de 2 à 5 ans en 2017', 'Nombre de personnes scolarisées de 6 à 10 ans en 2017', 'Nombre de personnes scolarisées de 11 à 14 ans en 2017', 'Nombre de personnes scolarisées de 15 à 17 ans en 2017', 'Nombre de personnes scolarisées de 18 à 24 ans en 2017', 'Nombre de personnes scolarisées de 25 à 29 ans en 2017', 'Nombre de personnes scolarisées de 30 ans ou plus en 2017', "Nombre d'hommes de 2 à 5 ans en 2017", "Nombre d'hommes de 6 à 10 ans en 2017", "Nombre d'hommes de 11 à 14 ans en 2017", "Nombre d'hommes de 15 à 17 ans en 2017", "Nombre d'hommes de 18 à 24 ans en 2017", "Nombre d'hommes de 25 à 29 ans en 2017", "Nombre d'hommes de 30 ans ou plus en 2017", "Nombre d'hommes scolarisés de 2 à 5 ans en 2017", "Nombre d'hommes scolarisés de 6 à 10 ans en 2017", "Nombre d'hommes scolarisés de 11 à 14 ans en 2017", "Nombre d'hommes scolarisés de 15 à 17 ans en 2017", "Nombre d'hommes scolarisés de 18 à 24 ans en 2017", "Nombre d'hommes scolarisés de 25 à 29 ans en 2017", "Nombre d'hommes scolarisés de 30 ans ou plus en 2017", 'Nombre de femmes de 2 à 5 ans en 2017', 'Nombre de femmes de 6 à 10 ans en 2017', 'Nombre de femmes de 11 à 14 ans en 2017', 'Nombre de femmes de 15 à 17 ans en 2017', 'Nombre de femmes de 18 à 24 ans en 2017', 'Nombre de femmes de 25 à 29 ans en 2017', 'Nombre de femmes de 30 ans ou plus en 2017', 'Nombre de femmes scolarisées de 2 à 5 ans en 2017', 'Nombre de femmes scolarisées de 6 à 10 ans en 2017', 'Nombre de femmes scolarisées de 11 à 14 ans en 2017', 'Nombre de femmes scolarisées de 15 à 17 ans en 2017', 'Nombre de femmes scolarisées de 18 à 24 ans en 2017', 'Nombre de femmes scolarisées de 25 à 29 ans en 2017', 'Nombre de femmes scolarisées de 30 ans ou plus en 2017', 'Nombre de personnes non scolarisées de 15 ans ou plus en 2017', "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017", 'Nombre de hommes non scolarisées de 15 ans ou plus en 2017', "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017", "Nombre de hommes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017", 'Nombre de femmes non scolarisées de 15 ans ou plus en 2017', "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017", 'Nombre de personnes de 2 à 5 ans en 2012', 'Nombre de personnes de 6 à 10 ans en 2012', 'Nombre de personnes de 11 à 14 ans en 2012', 'Nombre de personnes de 15 à 17 ans en 2012', 'Nombre de personnes de 18 à 24 ans en 2012', 'Nombre de personnes de 25 à 29 ans en 2012', 'Nombre de personnes de 30 ans ou plus en 2012', 'Nombre de personnes scolarisées de 2 à 5 ans en 2012', 'Nombre de personnes scolarisées de 6 à 10 ans en 2012', 'Nombre de personnes scolarisées de 11 à 14 ans en 2012', 'Nombre de personnes scolarisées de 15 à 17 ans en 2012', 'Nombre de personnes scolarisées de 18 à 24 ans en 2012', 'Nombre de personnes scolarisées de 25 à 29 ans en 2012', 'Nombre de personnes scolarisées de 30 ans ou plus en 2012', "Nombre d'hommes de 2 à 5 ans en 2012", "Nombre d'hommes de 6 à 10 ans en 2012", "Nombre d'hommes de 11 à 14 ans en 2012", "Nombre d'hommes de 15 à 17 ans en 2012", "Nombre d'hommes de 18 à 24 ans en 2012", "Nombre d'hommes de 25 à 29 ans en 2012", "Nombre d'hommes de 30 ans ou plus en 2012", "Nombre d'hommes scolarisés de 2 à 5 ans en 2012", "Nombre d'hommes scolarisés de 6 à 10 ans en 2012", "Nombre d'hommes scolarisés de 11 à 14 ans en 2012", "Nombre d'hommes scolarisés de 15 à 17 ans en 2012", "Nombre d'hommes scolarisés de 18 à 24 ans en 2012", "Nombre d'hommes scolarisés de 25 à 29 ans en 2012", "Nombre d'hommes scolarisés de 30 ans ou plus en 2012", 'Nombre de femmes de 2 à 5 ans en 2012', 'Nombre de femmes de 6 à 10 ans en 2012', 'Nombre de femmes de 11 à 14 ans en 2012', 'Nombre de femmes de 15 à 17 ans en 2012', 'Nombre de femmes de 18 à 24 ans en 2012', 'Nombre de femmes de 25 à 29 ans en 2012', 'Nombre de femmes de 30 ans ou plus en 2012', 'Nombre de femmes scolarisées de 2 à 5 ans en 2012', 'Nombre de femmes scolarisées de 6 à 10 ans en 2012', 'Nombre de femmes scolarisées de 11 à 14 ans en 2012', 'Nombre de femmes scolarisées de 15 à 17 ans en 2012', 'Nombre de femmes scolarisées de 18 à 24 ans en 2012', 'Nombre de femmes scolarisées de 25 à 29 ans en 2012', 'Nombre de femmes scolarisées de 30 ans ou plus en 2012', 'Nombre de personnes non scolarisées de 15 ans ou plus en 2012', "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme en 2012", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires du certificat d'études primaires en 2012", 'Nombre de personnes non scolarisées de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2012', "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2012", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2012", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2012", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'aucun diplôme en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires du certificat d'études primaires en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2012", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2012", 'Nombre de femmes non scolarisées de 15 ans ou plus en 2012', "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme en 2012", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires du certificat d'études primaires en 2012", 'Nombre de femmes non scolarisées de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2012', "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2012", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2012", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2012", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2012", 'Nombre de personnes de 2 à 5 ans en 2007', 'Nombre de personnes de 6 à 10 ans en 2007', 'Nombre de personnes de 11 à 14 ans en 2007', 'Nombre de personnes de 15 à 17 ans en 2007', 'Nombre de personnes de 18 à 24 ans en 2007', 'Nombre de personnes de 25 à 29 ans en 2007', 'Nombre de personnes de 30 ans ou plus en 2007', 'Nombre de personnes scolarisées de 2 à 5 ans en 2007', 'Nombre de personnes scolarisées de 6 à 10 ans en 2007', 'Nombre de personnes scolarisées de 11 à 14 ans en 2007', 'Nombre de personnes scolarisées de 15 à 17 ans en 2007', 'Nombre de personnes scolarisées de 18 à 24 ans en 2007', 'Nombre de personnes scolarisées de 25 à 29 ans en 2007', 'Nombre de personnes scolarisées de 30 ans ou plus en 2007', "Nombre d'hommes de 2 à 5 ans en 2007", "Nombre d'hommes de 6 à 10 ans en 2007", "Nombre d'hommes de 11 à 14 ans en 2007", "Nombre d'hommes de 15 à 17 ans en 2007", "Nombre d'hommes de 18 à 24 ans en 2007", "Nombre d'hommes de 25 à 29 ans en 2007", "Nombre d'hommes de 30 ans ou plus en 2007", "Nombre d'hommes scolarisés de 2 à 5 ans en 2007", "Nombre d'hommes scolarisés de 6 à 10 ans en 2007", "Nombre d'hommes scolarisés de 11 à 14 ans en 2007", "Nombre d'hommes scolarisés de 15 à 17 ans en 2007", "Nombre d'hommes scolarisés de 18 à 24 ans en 2007", "Nombre d'hommes scolarisés de 25 à 29 ans en 2007", "Nombre d'hommes scolarisés de 30 ans ou plus en 2007", 'Nombre de femmes de 2 à 5 ans en 2007', 'Nombre de femmes de 6 à 10 ans en 2007', 'Nombre de femmes de 11 à 14 ans en 2007', 'Nombre de femmes de 15 à 17 ans en 2007', 'Nombre de femmes de 18 à 24 ans en 2007', 'Nombre de femmes de 25 à 29 ans en 2007', 'Nombre de femmes de 30 ans ou plus en 2007', 'Nombre de femmes scolarisées de 2 à 5 ans en 2007', 'Nombre de femmes scolarisées de 6 à 10 ans en 2007', 'Nombre de femmes scolarisées de 11 à 14 ans en 2007', 'Nombre de femmes scolarisées de 15 à 17 ans en 2007', 'Nombre de femmes scolarisées de 18 à 24 ans en 2007', 'Nombre de femmes scolarisées de 25 à 29 ans en 2007', 'Nombre de femmes scolarisées de 30 ans ou plus en 2007', 'Nombre de personnes non scolarisées de 15 ans ou plus en 2007', "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme en 2007", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires du certificat d'études primaires en 2007", 'Nombre de personnes non scolarisées de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2007', "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2007", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2007", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2007", "Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'aucun diplôme en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires du certificat d'études primaires en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2007", "Nombre d'hommes non scolarisés de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2007", 'Nombre de femmes non scolarisées de 15 ans ou plus en 2007', "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme en 2007", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires du certificat d'études primaires en 2007", 'Nombre de femmes non scolarisées de 15 ans ou plus titulaires du BEPC, brevet des collèges en 2007', "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un CAP ou d'un BEP en 2007", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un baccalauréat ou d'un brevet professionnel en 2007", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur court en 2007", "Nombre de femmes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur long en 2007"]</code></pre>
</div>
</div>
<p><strong>Select the variables of interest</strong></p>
<div id="cell-104" class="cell" data-outputid="bb59b058-3fff-4d9b-e5d9-c45bdc0fd879" data-execution_count="49">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_educ <span class="op">=</span> df_educ.iloc[:,([<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>] <span class="op">+</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">44</span>,<span class="dv">52</span>)))]</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>df_educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="49">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>107.168650</td>
<td>26.381412</td>
<td>186.909421</td>
<td>95.095609</td>
<td>71.803960</td>
<td>39.398005</td>
<td>31.348250</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>22.452675</td>
<td>7.144033</td>
<td>47.967078</td>
<td>38.781893</td>
<td>25.514403</td>
<td>20.411523</td>
<td>16.329218</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>2207.010696</td>
<td>588.550154</td>
<td>2799.751384</td>
<td>1938.190106</td>
<td>1236.633482</td>
<td>739.951919</td>
<td>638.938455</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>294.111609</td>
<td>55.410401</td>
<td>371.050484</td>
<td>221.492025</td>
<td>148.096276</td>
<td>85.523268</td>
<td>58.675674</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.154545</td>
<td>4.036364</td>
<td>31.281818</td>
<td>30.272727</td>
<td>5.045455</td>
<td>5.045455</td>
<td>3.027273</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><em>We can notice that the number of rows in df_pop (34993) is not identical to the number of rows in df_educ (34996). Lets look for the communes that are not available in the df_pop database.</em></p>
<div id="cell-106" class="cell" data-outputid="f9ea2e34-b64b-4c34-d145-58c56e0cf6fc" data-execution_count="50">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the unique values of 'Commune ou ARM' in each DataFrame</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>valeurs_df_educ <span class="op">=</span> <span class="bu">set</span>(df_educ[<span class="st">'CODGEO'</span>].unique())</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>valeurs_df_pop <span class="op">=</span> <span class="bu">set</span>(df_pop[<span class="st">'CODGEO'</span>].unique())</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the "Commune ou ARM" available if df_educ but not in df_pop</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>valeurs_diff <span class="op">=</span> valeurs_df_educ <span class="op">-</span> valeurs_df_pop</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the results</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"'Commune ou ARM' available in 'df_educ' but not in 'df_pop' :"</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(valeurs_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'Commune ou ARM' available in 'df_educ' but not in 'df_pop' :
{'69123', '75056', '13055'}</code></pre>
</div>
</div>
<p><em>The communes ‘69123’, ‘13055’, ‘75056’ are no longer available</em></p>
<p><strong>In order to compute the total population of 15 years old people and older eligible to gratuate from a diploma, we first store the variables of intrest in the “var_sum_2” database</strong></p>
<div id="cell-109" class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>var_sum_2 <span class="op">=</span> df_educ[[<span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">aucun diplôme ou au plus un CEP en 2017'</span>,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un BEPC, brevet des collèges, DNB en 2017'</span>,</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un CAP, d</span><span class="ch">\'</span><span class="st">un BEP ou équivalent en 2017'</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un Baccalauréat, brevet professionnel ou équivalent en 2017'</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 2 en 2017'</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017'</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 5 ou plus en 2017'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We compute the total population of 15 years old people and older eligible to gratuate from a diploma</strong></p>
<div id="cell-111" class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df_educ[<span class="st">'Pop plus 15 ans éligible diplôme'</span>] <span class="op">=</span> var_sum_2.<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We now want to compute the proportion of people belonging to a given category of diploma</strong></p>
<div id="cell-113" class="cell" data-outputid="9d3bef9a-cc5b-4986-ef2b-06c6532d0f7d" data-execution_count="53">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of columns to divide</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>columns_to_divide_2 <span class="op">=</span> [<span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">aucun diplôme ou au plus un CEP en 2017'</span>,</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un BEPC, brevet des collèges, DNB en 2017'</span>,</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un CAP, d</span><span class="ch">\'</span><span class="st">un BEP ou équivalent en 2017'</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un Baccalauréat, brevet professionnel ou équivalent en 2017'</span>,</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 2 en 2017'</span>,</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017'</span>,</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>                       <span class="st">'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 5 ou plus en 2017'</span>]</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Divide each of the columns above by 'Pop plus 15 ans éligible diplôme'</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>df_educ[columns_to_divide_2] <span class="op">=</span> df_educ[columns_to_divide_2].div(df_educ[<span class="st">'Pop plus 15 ans éligible diplôme'</span>], axis<span class="op">=</span><span class="dv">0</span>)<span class="op">*</span><span class="dv">100</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the database</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>df_educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pop plus 15 ans éligible diplôme</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>12.865665</td>
<td>7.059242</td>
<td>5.616906</td>
<td>558.105307</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>14.285714</td>
<td>11.428571</td>
<td>9.142857</td>
<td>178.600823</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>12.184750</td>
<td>7.290866</td>
<td>6.295564</td>
<td>10149.026196</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>11.997821</td>
<td>6.928553</td>
<td>4.753531</td>
<td>1234.359736</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>5.263158</td>
<td>5.263158</td>
<td>3.157895</td>
<td>95.863636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Adding the prefixe “Pourcentage” to each of the variables above</strong></p>
<div id="cell-115" class="cell" data-outputid="860a853f-0cc0-4682-8d56-6fe9b522f8f2" data-execution_count="54">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the prefixe "Pourcentage"</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>df_educ.rename(columns<span class="op">=</span>{col: <span class="ss">f"Pourcentage </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span> <span class="cf">for</span> col <span class="kw">in</span> columns_to_divide_2}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the database</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>df_educ.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 2 en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un diplôme de l'enseignement supérieur de niveau Bac + 5 ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pop plus 15 ans éligible diplôme</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>12.865665</td>
<td>7.059242</td>
<td>5.616906</td>
<td>558.105307</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>14.285714</td>
<td>11.428571</td>
<td>9.142857</td>
<td>178.600823</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>12.184750</td>
<td>7.290866</td>
<td>6.295564</td>
<td>10149.026196</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>11.997821</td>
<td>6.928553</td>
<td>4.753531</td>
<td>1234.359736</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>5.263158</td>
<td>5.263158</td>
<td>3.157895</td>
<td>95.863636</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="loading-the-urban-density-dictionnary" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-urban-density-dictionnary">Loading the urban density dictionnary</h2>
<div id="cell-117" class="cell" data-outputid="63e009f5-f4e3-42a5-b80c-fc98553d09c4" data-execution_count="55">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dens_dict <span class="op">=</span> pd.read_excel(os.path.join(dir_data, <span class="st">"grille_densite_7_niveaux_2017.xlsx"</span>), header<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>dens_dict.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">LIBGEO</th>
<th data-quarto-table-cell-role="th">DENS</th>
<th data-quarto-table-cell-role="th">LIBDENS</th>
<th data-quarto-table-cell-role="th">PMUN15</th>
<th data-quarto-table-cell-role="th">P1</th>
<th data-quarto-table-cell-role="th">P2</th>
<th data-quarto-table-cell-role="th">P3</th>
<th data-quarto-table-cell-role="th">P4</th>
<th data-quarto-table-cell-role="th">P5</th>
<th data-quarto-table-cell-role="th">P6</th>
<th data-quarto-table-cell-role="th">P7</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'Abergement-Clémenciat</td>
<td>6</td>
<td>Rural à habitat dispersé</td>
<td>767</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.00</td>
<td>0.00</td>
<td>78.60</td>
<td>21.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'Abergement-de-Varey</td>
<td>6</td>
<td>Rural à habitat dispersé</td>
<td>241</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.00</td>
<td>0.00</td>
<td>88.08</td>
<td>11.92</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>2</td>
<td>Centres urbains intermédiaires</td>
<td>14127</td>
<td>0.0</td>
<td>70.85</td>
<td>0.0</td>
<td>24.85</td>
<td>0.00</td>
<td>3.54</td>
<td>0.75</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>Ambérieux-en-Dombes</td>
<td>5</td>
<td>Bourgs ruraux</td>
<td>1619</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.00</td>
<td>83.08</td>
<td>9.42</td>
<td>7.50</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>Ambléon</td>
<td>6</td>
<td>Rural à habitat dispersé</td>
<td>109</td>
<td>0.0</td>
<td>0.00</td>
<td>0.0</td>
<td>0.00</td>
<td>0.00</td>
<td>100.00</td>
<td>0.00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Taking off the first 0s in the ‘CODGEO’ column</strong></p>
<div id="cell-119" class="cell" data-outputid="c5f50e3a-0aec-47d9-e53b-78249fd4f632" data-execution_count="56">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>dens_dict[<span class="st">'CODGEO'</span>] <span class="op">=</span> dens_dict[<span class="st">'CODGEO'</span>].<span class="bu">str</span>.replace(<span class="st">'^0+'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>dens_dict[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>0    1001
1    1002
2    1004
3    1005
4    1006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
<p><strong>Keeping only the density labels of the ‘communes’</strong></p>
<div id="cell-121" class="cell" data-outputid="594488f7-a8b1-4571-ca43-b61d5a9190e8" data-execution_count="57">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dens_dict <span class="op">=</span> dens_dict.loc[:, [<span class="st">'CODGEO'</span>, <span class="st">'LIBGEO'</span>, <span class="st">'LIBDENS'</span>]]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>dens_dict.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">LIBGEO</th>
<th data-quarto-table-cell-role="th">LIBDENS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>L'Abergement-Clémenciat</td>
<td>Rural à habitat dispersé</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>L'Abergement-de-Varey</td>
<td>Rural à habitat dispersé</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>Ambérieu-en-Bugey</td>
<td>Centres urbains intermédiaires</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>Ambérieux-en-Dombes</td>
<td>Bourgs ruraux</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>Ambléon</td>
<td>Rural à habitat dispersé</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Lets see what are the different kinds of density labels that we have in our database</strong></p>
<div id="cell-123" class="cell" data-outputid="ebe00df6-dbd3-4ec1-df80-a94a8d868671" data-execution_count="58">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>dens_dict[<span class="st">'LIBDENS'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>array(['Rural à habitat dispersé', 'Centres urbains intermédiaires',
       'Bourgs ruraux', 'Ceintures urbaines',
       'Rural à habitat très dispersé', 'Petites villes',
       'Grands centres urbains'], dtype=object)</code></pre>
</div>
</div>
<p><strong>Convert the variables in strings</strong></p>
<div id="cell-125" class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>dens_dict <span class="op">=</span> dens_dict.astype({</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CODGEO'</span> : <span class="st">'object'</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LIBGEO'</span> : <span class="st">'object'</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'LIBDENS'</span> : <span class="st">'object'</span></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Rename ‘LIBGEO’ into ‘LIBCOM’</strong></p>
<div id="cell-127" class="cell" data-outputid="e769c2c3-0738-49c5-c403-d67a54b207ce" data-execution_count="60">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dens_dict <span class="op">=</span> dens_dict.rename(columns<span class="op">=</span>{<span class="st">'LIBGEO'</span>:<span class="st">'LIBCOM'</span>})</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>dens_dict.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">LIBDENS</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>L'Abergement-Clémenciat</td>
<td>Rural à habitat dispersé</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>L'Abergement-de-Varey</td>
<td>Rural à habitat dispersé</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>Ambérieu-en-Bugey</td>
<td>Centres urbains intermédiaires</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>Ambérieux-en-Dombes</td>
<td>Bourgs ruraux</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>Ambléon</td>
<td>Rural à habitat dispersé</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="loading-the-disposable-income-dataset" class="level2">
<h2 class="anchored" data-anchor-id="loading-the-disposable-income-dataset">Loading the disposable income dataset</h2>
<div id="cell-129" class="cell" data-outputid="841edb87-d972-4600-ed97-d11d1bf1ff98" data-execution_count="61">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>df_income <span class="op">=</span> pd.read_excel(os.path.join(dir_data, <span class="st">"indic-struct-distrib-revenu-2017-COMMUNES/FILO2017_DISP_COM.xlsx"</span>), sheet_name <span class="op">=</span><span class="st">'ENSEMBLE'</span>, header <span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>df_income <span class="op">=</span> df_income.iloc[<span class="dv">1</span>:,:].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>df_income.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="61">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Code géographique</th>
<th data-quarto-table-cell-role="th">Libellé géographique</th>
<th data-quarto-table-cell-role="th">Nbre de ménages fiscaux</th>
<th data-quarto-table-cell-role="th">Nbre de personnes dans les ménages fiscaux</th>
<th data-quarto-table-cell-role="th">Nbre d'unités de consommation dans les ménages fiscaux</th>
<th data-quarto-table-cell-role="th">1er quartile (€)</th>
<th data-quarto-table-cell-role="th">Médiane (€)</th>
<th data-quarto-table-cell-role="th">3e quartile (€)</th>
<th data-quarto-table-cell-role="th">Écart interquartile (€)</th>
<th data-quarto-table-cell-role="th">1er décile (€)</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">dont part des salaires et traitements(%)</th>
<th data-quarto-table-cell-role="th">dont part des indemnités de chômage (%)</th>
<th data-quarto-table-cell-role="th">dont part des revenus des activités non salariées (%)</th>
<th data-quarto-table-cell-role="th">Part des pensions, retraites et rentes (%)</th>
<th data-quarto-table-cell-role="th">Part des revenus du patrimoine et autres revenus (%)</th>
<th data-quarto-table-cell-role="th">Part de l'ensemble des prestations sociales (%)</th>
<th data-quarto-table-cell-role="th">dont part des prestations familiales (%)</th>
<th data-quarto-table-cell-role="th">dont part des minima sociaux (%)</th>
<th data-quarto-table-cell-role="th">dont part des prestations logement (%)</th>
<th data-quarto-table-cell-role="th">Part des impôts (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'Abergement-Clémenciat</td>
<td>317</td>
<td>802</td>
<td>534.6</td>
<td>NaN</td>
<td>23310</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'Abergement-de-Varey</td>
<td>107</td>
<td>258</td>
<td>170.9</td>
<td>NaN</td>
<td>24290</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>6505</td>
<td>14567</td>
<td>9978.4</td>
<td>14470</td>
<td>19860</td>
<td>26280</td>
<td>11820</td>
<td>10710</td>
<td>...</td>
<td>65.9</td>
<td>3.6</td>
<td>3.4</td>
<td>26.9</td>
<td>8.7</td>
<td>7.1</td>
<td>2.9</td>
<td>2.3</td>
<td>1.9</td>
<td>-15.5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>Ambérieux-en-Dombes</td>
<td>649</td>
<td>1700</td>
<td>1109.5</td>
<td>NaN</td>
<td>23370</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>Ambléon</td>
<td>49</td>
<td>106</td>
<td>75.4</td>
<td>NaN</td>
<td>23970</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>...</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>

<p>5 rows × 31 columns</p>
</div>
</div>
</div>
<p><strong>Lets see the variables we have in our database</strong></p>
<div id="cell-131" class="cell" data-outputid="cb8fd35d-f49c-423e-a748-855b29767616" data-execution_count="62">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(df_income.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Code géographique', 'Libellé géographique', 'Nbre de ménages fiscaux', 'Nbre de personnes dans les ménages fiscaux', "Nbre d'unités de consommation dans les ménages fiscaux", '1er quartile (€)', 'Médiane (€)', '3e quartile (€)', 'Écart interquartile (€)', '1er décile (€)', '2e décile (€)', '3e décile (€)', '4e décile (€)', '6e décile (€)', '7e décile (€)', '8e décile (€)', '9e décile (€)', 'Rapport interdécile 9e décile/1er decile', 'S80/20', 'Indice de Gini', 'Part des revenus d’activité (%)', 'dont part des salaires et traitements(%)', 'dont part des indemnités de chômage (%)', 'dont part des revenus des activités non salariées (%)', 'Part des pensions, retraites et rentes (%)', 'Part des revenus du patrimoine et autres revenus (%)', "Part de l'ensemble des prestations sociales (%)", 'dont part des prestations familiales (%)', 'dont part des minima sociaux (%)', 'dont part des prestations logement (%)', 'Part des impôts (%)']</code></pre>
</div>
</div>
<p><strong>We want to keep the variables ‘Code géographique’, ‘Libellé géographique’and ’Médiane (€)’ only</strong></p>
<div id="cell-133" class="cell" data-outputid="227778d2-83d2-45d9-8458-3d0cc965728e" data-execution_count="63">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>df_income <span class="op">=</span> df_income.loc[:, [<span class="st">'Code géographique'</span>, <span class="st">'Libellé géographique'</span>, <span class="st">'Médiane (€)'</span>]]</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>df_income.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="63">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Code géographique</th>
<th data-quarto-table-cell-role="th">Libellé géographique</th>
<th data-quarto-table-cell-role="th">Médiane (€)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>L'Abergement-Clémenciat</td>
<td>23310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>L'Abergement-de-Varey</td>
<td>24290</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>Ambérieu-en-Bugey</td>
<td>19860</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>Ambérieux-en-Dombes</td>
<td>23370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>Ambléon</td>
<td>23970</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>We rename the columns ‘Code géographique’ into ‘CODGEO’ and the column ‘Libellé géographique’ into ‘LIBCOM’</strong></p>
<div id="cell-135" class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>df_income <span class="op">=</span> df_income.rename(columns<span class="op">=</span>{<span class="st">'Code géographique'</span> : <span class="st">'CODGEO'</span>,</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Libellé géographique'</span> : <span class="st">'LIBCOM'</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We take off the 0s located in first position in the ‘CODGEO’ column</strong></p>
<div id="cell-137" class="cell" data-outputid="d1fd5b48-284f-4332-e121-97d684ef2ad6" data-execution_count="65">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df_income[<span class="st">'CODGEO'</span>] <span class="op">=</span> df_income[<span class="st">'CODGEO'</span>].<span class="bu">str</span>.replace(<span class="st">'^0+'</span>, <span class="st">''</span>, regex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>df_income[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>0    1001
1    1002
2    1004
3    1005
4    1006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
</section>
</section>
<section id="merge-the-databases" class="level1">
<h1>MERGE THE DATABASES</h1>
<p><strong>We start by merging df_educ and df_pop together through ‘CODGEO’ and ‘LIBCOM’</strong></p>
<div id="cell-140" class="cell" data-outputid="97b2c39c-8a90-4d19-89b9-3e1f69fe72db" data-execution_count="66">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> pd.merge(df_educ, df_pop, on<span class="op">=</span>[<span class="st">'CODGEO'</span>, <span class="st">'LIBCOM'</span>], how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>a.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 80 ans ou plus en 2018 (princ)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Agriculteurs exploitants en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Artisans, Comm., Chefs entr. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Cadres, Prof. intel. sup. en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Prof. intermédiaires en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Employés en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Ouvriers en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pourcentage Pop 15 ans ou plus Retraités en 2018 (compl)</th>
<th data-quarto-table-cell-role="th">Pop plus 15 ans actifs</th>
<th data-quarto-table-cell-role="th">Pop plus 18 ans</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>...</td>
<td>5.691517</td>
<td>2.628536</td>
<td>3.402263</td>
<td>12.957549</td>
<td>16.622248</td>
<td>17.165377</td>
<td>21.588013</td>
<td>25.636015</td>
<td>581.711296</td>
<td>579.696742</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>...</td>
<td>6.077348</td>
<td>0.000000</td>
<td>11.428571</td>
<td>8.571429</td>
<td>14.285714</td>
<td>22.857143</td>
<td>5.714286</td>
<td>37.142857</td>
<td>182.201646</td>
<td>188.448560</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>...</td>
<td>7.010961</td>
<td>0.028942</td>
<td>3.367281</td>
<td>8.111499</td>
<td>19.645698</td>
<td>19.716637</td>
<td>20.935426</td>
<td>28.194517</td>
<td>9640.285575</td>
<td>10898.460930</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>...</td>
<td>5.555556</td>
<td>0.386100</td>
<td>8.880309</td>
<td>8.880309</td>
<td>17.374517</td>
<td>23.166023</td>
<td>14.671815</td>
<td>26.640927</td>
<td>1249.943883</td>
<td>1320.404040</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>...</td>
<td>8.421053</td>
<td>0.000000</td>
<td>0.000000</td>
<td>5.882353</td>
<td>29.411765</td>
<td>17.647059</td>
<td>17.647059</td>
<td>29.411765</td>
<td>86.545455</td>
<td>96.727273</td>
</tr>
</tbody>
</table>

<p>5 rows × 30 columns</p>
</div>
</div>
</div>
<p><strong>We merge now dens_dict and elections together through ‘CODGEO’ and ‘LIBCOM’</strong></p>
<div id="cell-142" class="cell" data-outputid="92084d34-9af3-4a4d-ac37-7abb4d7da3c6" data-execution_count="67">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> pd.merge(dens_dict, elections, on<span class="op">=</span>[<span class="st">'CODGEO'</span>, <span class="st">'LIBCOM'</span>], how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>b.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">LIBDENS</th>
<th data-quarto-table-cell-role="th">Inscrits</th>
<th data-quarto-table-cell-role="th">Abstentions</th>
<th data-quarto-table-cell-role="th">% Abs/Ins</th>
<th data-quarto-table-cell-role="th">Votants</th>
<th data-quarto-table-cell-role="th">% Vot/Ins</th>
<th data-quarto-table-cell-role="th">Blancs</th>
<th data-quarto-table-cell-role="th">% Blancs/Ins</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.7</th>
<th data-quarto-table-cell-role="th">Nom.8</th>
<th data-quarto-table-cell-role="th">Prénom.8</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.8</th>
<th data-quarto-table-cell-role="th">Nom.9</th>
<th data-quarto-table-cell-role="th">Prénom.9</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.9</th>
<th data-quarto-table-cell-role="th">Nom.10</th>
<th data-quarto-table-cell-role="th">Prénom.10</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1001</td>
<td>L'Abergement-Clémenciat</td>
<td>Rural à habitat dispersé</td>
<td>598</td>
<td>92</td>
<td>15.38</td>
<td>506</td>
<td>84.62</td>
<td>2</td>
<td>0.33</td>
<td>...</td>
<td>0.81</td>
<td>POUTOU</td>
<td>Philippe</td>
<td>0.81</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.40</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1002</td>
<td>L'Abergement-de-Varey</td>
<td>Rural à habitat dispersé</td>
<td>209</td>
<td>25</td>
<td>11.96</td>
<td>184</td>
<td>88.04</td>
<td>6</td>
<td>2.87</td>
<td>...</td>
<td>1.14</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.57</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1004</td>
<td>Ambérieu-en-Bugey</td>
<td>Centres urbains intermédiaires</td>
<td>8586</td>
<td>1962</td>
<td>22.85</td>
<td>6624</td>
<td>77.15</td>
<td>114</td>
<td>1.33</td>
<td>...</td>
<td>1.10</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.93</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.62</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1005</td>
<td>Ambérieux-en-Dombes</td>
<td>Bourgs ruraux</td>
<td>1172</td>
<td>215</td>
<td>18.34</td>
<td>957</td>
<td>81.66</td>
<td>21</td>
<td>1.79</td>
<td>...</td>
<td>1.07</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.64</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.54</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1006</td>
<td>Ambléon</td>
<td>Rural à habitat dispersé</td>
<td>99</td>
<td>20</td>
<td>20.20</td>
<td>79</td>
<td>79.80</td>
<td>2</td>
<td>2.02</td>
<td>...</td>
<td>1.30</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>1.30</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>5 rows × 50 columns</p>
</div>
</div>
</div>
<p><strong>We move forward to merge the 2 previous merged databses together through ‘CODGEO’ and ‘LIBCOM’</strong></p>
<div id="cell-144" class="cell" data-outputid="7f9121e1-db38-47c2-9c76-f35437d80852" data-execution_count="68">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(a, b, how <span class="op">=</span> <span class="st">'inner'</span>, on <span class="op">=</span> [<span class="st">'CODGEO'</span>, <span class="st">'LIBCOM'</span>])</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>merged_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="68">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.7</th>
<th data-quarto-table-cell-role="th">Nom.8</th>
<th data-quarto-table-cell-role="th">Prénom.8</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.8</th>
<th data-quarto-table-cell-role="th">Nom.9</th>
<th data-quarto-table-cell-role="th">Prénom.9</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.9</th>
<th data-quarto-table-cell-role="th">Nom.10</th>
<th data-quarto-table-cell-role="th">Prénom.10</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>...</td>
<td>0.81</td>
<td>POUTOU</td>
<td>Philippe</td>
<td>0.81</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.40</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.40</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>...</td>
<td>1.14</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.57</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>...</td>
<td>1.10</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.93</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.62</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>...</td>
<td>1.07</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.64</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.54</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>...</td>
<td>1.30</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>1.30</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.00</td>
</tr>
</tbody>
</table>

<p>5 rows × 78 columns</p>
</div>
</div>
</div>
<p><strong>Once a and b merged, we now want to add the df_income columns in the merged_df database</strong></p>
<div id="cell-146" class="cell" data-outputid="fe7941e3-13b6-4b9a-914e-c069cdff5b2d" data-execution_count="69">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> pd.merge(merged_df, df_income, how<span class="op">=</span><span class="st">'inner'</span>, on <span class="op">=</span> [<span class="st">'CODGEO'</span>, <span class="st">'LIBCOM'</span>])</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>merged_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LIBCOM</th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 18 à 24 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 25 à 29 ans en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes de 30 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Nombre de personnes non scolarisées de 15 ans ou plus en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'aucun diplôme ou au plus un CEP en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un BEPC, brevet des collèges, DNB en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un CAP, d'un BEP ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un Baccalauréat, brevet professionnel ou équivalent en 2017</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Nom.8</th>
<th data-quarto-table-cell-role="th">Prénom.8</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.8</th>
<th data-quarto-table-cell-role="th">Nom.9</th>
<th data-quarto-table-cell-role="th">Prénom.9</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.9</th>
<th data-quarto-table-cell-role="th">Nom.10</th>
<th data-quarto-table-cell-role="th">Prénom.10</th>
<th data-quarto-table-cell-role="th">% Voix/Exp.10</th>
<th data-quarto-table-cell-role="th">Médiane (€)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>L'Abergement-Clémenciat</td>
<td>1001</td>
<td>36.308136</td>
<td>33.410552</td>
<td>511.545180</td>
<td>558.105307</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>...</td>
<td>POUTOU</td>
<td>Philippe</td>
<td>0.81</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.40</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.40</td>
<td>23310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>L'Abergement-de-Varey</td>
<td>1002</td>
<td>8.164609</td>
<td>13.267490</td>
<td>163.292181</td>
<td>178.600823</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>...</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.57</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.00</td>
<td>24290</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Ambérieu-en-Bugey</td>
<td>1004</td>
<td>1285.707165</td>
<td>1108.451063</td>
<td>8321.381280</td>
<td>10149.026196</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>...</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.93</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.62</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.08</td>
<td>19860</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Ambérieux-en-Dombes</td>
<td>1005</td>
<td>126.396133</td>
<td>73.152717</td>
<td>1085.498171</td>
<td>1234.359736</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>...</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>0.64</td>
<td>ARTHAUD</td>
<td>Nathalie</td>
<td>0.54</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>23370</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Ambléon</td>
<td>1006</td>
<td>7.063636</td>
<td>6.054545</td>
<td>82.745455</td>
<td>95.863636</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>...</td>
<td>LASSALLE</td>
<td>Jean</td>
<td>1.30</td>
<td>CHEMINADE</td>
<td>Jacques</td>
<td>0.00</td>
<td>ASSELINEAU</td>
<td>François</td>
<td>0.00</td>
<td>23970</td>
</tr>
</tbody>
</table>

<p>5 rows × 79 columns</p>
</div>
</div>
</div>
<p><strong>In opposition to what we did at the begining of the notebook, we want now to add a 0 at the begining of each commune’s code (because its required to visualize later on all the communes and their cluster on a France map)</strong></p>
<div id="cell-148" class="cell" data-outputid="ae2e0488-b2af-4ff8-a537-94d2ccbd8bed" data-execution_count="70">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'CODGEO'</span>] <span class="op">=</span> merged_df[<span class="st">'CODGEO'</span>].<span class="bu">str</span>.zfill(<span class="dv">5</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'CODGEO'</span>].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>0    01001
1    01002
2    01004
3    01005
4    01006
Name: CODGEO, dtype: object</code></pre>
</div>
</div>
<p><strong>We can see that some education variables have labels that are too long and won’t be visualized properly in our visualization tools. These need to be shortered.</strong></p>
<div id="cell-150" class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> renommer_variables(variables):</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    nouvelles_variables <span class="op">=</span> []</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> variables:</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace 'Pourcentage' by 'Perc'</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">'Pourcentage '</span>, <span class="st">'Perc_'</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take off 'Nombre de personnes non scolarisées de 15 ans ou plus titulaires d\'un '</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"Nombre de personnes non scolarisées de 15 ans ou plus titulaires d'un "</span>, <span class="st">""</span>)</span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">"</span>, <span class="st">""</span>)</span>
<span id="cb93-12"><a href="#cb93-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take off ', diplôme de l\'enseignement supérieur de niveau '</span></span>
<span id="cb93-13"><a href="#cb93-13" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"diplôme de l'enseignement supérieur de niveau "</span>, <span class="st">"_"</span>)</span>
<span id="cb93-14"><a href="#cb93-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-15"><a href="#cb93-15" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Take off ' en 2017'</span></span>
<span id="cb93-16"><a href="#cb93-16" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">" en 2017"</span>, <span class="st">""</span>)</span>
<span id="cb93-17"><a href="#cb93-17" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">","</span>, <span class="st">""</span>)</span>
<span id="cb93-18"><a href="#cb93-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace the spaces by underscores</span></span>
<span id="cb93-20"><a href="#cb93-20" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb93-21"><a href="#cb93-21" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"ou équivalent"</span>, <span class="st">""</span>)</span>
<span id="cb93-22"><a href="#cb93-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-23"><a href="#cb93-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the renamed variable to the list</span></span>
<span id="cb93-24"><a href="#cb93-24" aria-hidden="true" tabindex="-1"></a>        nouvelles_variables.append(var)</span>
<span id="cb93-25"><a href="#cb93-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-26"><a href="#cb93-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nouvelles_variables</span>
<span id="cb93-27"><a href="#cb93-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-28"><a href="#cb93-28" aria-hidden="true" tabindex="-1"></a><span class="co"># List of variables before renaming</span></span>
<span id="cb93-29"><a href="#cb93-29" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [</span>
<span id="cb93-30"><a href="#cb93-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">aucun diplôme ou au plus un CEP en 2017'</span>,</span>
<span id="cb93-31"><a href="#cb93-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un BEPC, brevet des collèges, DNB en 2017'</span>,</span>
<span id="cb93-32"><a href="#cb93-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un CAP, d</span><span class="ch">\'</span><span class="st">un BEP ou équivalent en 2017'</span>,</span>
<span id="cb93-33"><a href="#cb93-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un Baccalauréat, brevet professionnel ou équivalent en 2017'</span>,</span>
<span id="cb93-34"><a href="#cb93-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 2 en 2017'</span>,</span>
<span id="cb93-35"><a href="#cb93-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Pourcentage Nombre de personnes non scolarisées de 15 ans ou plus titulaires d</span><span class="ch">\'</span><span class="st">un diplôme de l</span><span class="ch">\'</span><span class="st">enseignement supérieur de niveau Bac + 3 ou Bac + 4 en 2017'</span></span>
<span id="cb93-36"><a href="#cb93-36" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb93-37"><a href="#cb93-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-38"><a href="#cb93-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename variables</span></span>
<span id="cb93-39"><a href="#cb93-39" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> renommer_variables(merged_df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We can see that some socio-professional category variables have labels that are too long and won’t be visualized properly in our visualization tools. These need to be shortered.</strong></p>
<div id="cell-152" class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> renommer_variables(variables):</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    nouvelles_variables <span class="op">=</span> []</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> variables:</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"_en_2018_(compl)"</span>, <span class="st">""</span>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"Pop_15_ans_ou_plus_"</span>, <span class="st">""</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"Pop_15_ans_ou_plus_"</span>, <span class="st">""</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the renamed variable to the list</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>        nouvelles_variables.append(var)</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nouvelles_variables</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a><span class="co"># List of variables before renaming</span></span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [<span class="st">'Perc_Pop_15_ans_ou_plus_Agriculteurs_exploitants_en_2018_(compl)'</span>,</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Artisans_Comm._Chefs_entr._en_2018_(compl)'</span>,</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Cadres_Prof._intel._sup._en_2018_(compl)'</span>,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Prof._intermédiaires_en_2018_(compl)'</span>,</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Employés_en_2018_(compl)'</span>,</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Ouvriers_en_2018_(compl)'</span>,</span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_15_ans_ou_plus_Retraités_en_2018_(compl)'</span></span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the variables</span></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> renommer_variables(merged_df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We can see that some age variables have labels that could be better renamed</strong></p>
<div id="cell-154" class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> renommer_variables(variables):</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    nouvelles_variables <span class="op">=</span> []</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> var <span class="kw">in</span> variables:</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>        var <span class="op">=</span> var.replace(<span class="st">"_en_2018_(princ)"</span>, <span class="st">""</span>)</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add the renamed variable to the list</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>        nouvelles_variables.append(var)</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> nouvelles_variables</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co"># List of variable before renaming</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>variables <span class="op">=</span> [<span class="st">'Perc_Pop_18-24_ans_en_2018_(princ)'</span>,</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_25-39_ans_en_2018_(princ)'</span>,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_40-54_ans_en_2018_(princ)'</span>,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_55-64_ans_en_2018_(princ)'</span>,</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Pop_65-79_ans_en_2018_(princ)'</span></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the variables</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>merged_df.columns <span class="op">=</span> renommer_variables(merged_df.columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Lets see the new labels of our variables</strong></p>
<div id="cell-156" class="cell" data-outputid="78b741a8-5633-4d69-8bc9-38ba9178a495" data-execution_count="74">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(merged_df.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['LIBCOM', 'CODGEO', 'Nombre_de_personnes_de_18_à_24_ans', 'Nombre_de_personnes_de_25_à_29_ans', 'Nombre_de_personnes_de_30_ans_ou_plus', 'Nombre_de_personnes_non_scolarisées_de_15_ans_ou_plus', 'Perc_aucun_diplôme_ou_au_plus_un_CEP', 'Perc_BEPC_brevet_des_collèges_DNB', "Perc_CAP_d'un_BEP_ou_équivalent", 'Perc_Baccalauréat_brevet_professionnel_ou_équivalent', 'Perc__Bac_+_2', 'Perc__Bac_+_3_ou_Bac_+_4', 'Perc__Bac_+_5_ou_plus', 'Pop_plus_15_ans_éligible_diplôme', 'Population', 'Perc_Pop_18-24_ans', 'Perc_Pop_25-39_ans', 'Perc_Pop_40-54_ans', 'Perc_Pop_55-64_ans', 'Perc_Pop_65-79_ans', 'Perc_Pop_80_ans_ou_plus', 'Perc_Agriculteurs_exploitants', 'Perc_Artisans_Comm._Chefs_entr.', 'Perc_Cadres_Prof._intel._sup.', 'Perc_Prof._intermédiaires', 'Perc_Employés', 'Perc_Ouvriers', 'Perc_Retraités', 'Pop_plus_15_ans_actifs', 'Pop_plus_18_ans', 'LIBDENS', 'Inscrits', 'Abstentions', '%_Abs/Ins', 'Votants', '%_Vot/Ins', 'Blancs', '%_Blancs/Ins', '%_Blancs/Vot', 'Nuls', '%_Nuls/Ins', '%_Nuls/Vot', 'Exprimés', '%_Exp/Ins', '%_Exp/Vot', 'Nom', 'Prénom', '%_Voix/Exp', 'Nom.1', 'Prénom.1', '%_Voix/Exp.1', 'Nom.2', 'Prénom.2', '%_Voix/Exp.2', 'Nom.3', 'Prénom.3', '%_Voix/Exp.3', 'Nom.4', 'Prénom.4', '%_Voix/Exp.4', 'Nom.5', 'Prénom.5', '%_Voix/Exp.5', 'Nom.6', 'Prénom.6', '%_Voix/Exp.6', 'Nom.7', 'Prénom.7', '%_Voix/Exp.7', 'Nom.8', 'Prénom.8', '%_Voix/Exp.8', 'Nom.9', 'Prénom.9', '%_Voix/Exp.9', 'Nom.10', 'Prénom.10', '%_Voix/Exp.10', 'Médiane_(€)']</code></pre>
</div>
</div>
<p><strong>We save this merged database containing the voting proportions for each candidate in each commune because we will need it later on for our dashbord and our summary statistics, but not for our clustering processes.</strong></p>
<div id="cell-158" class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>merged_df.to_excel(os.path.join(dir_data, <span class="st">'merged_df_dashbord.xlsx'</span>))</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>merged_df_dashbord <span class="op">=</span> merged_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Some variables are out of interest for our clustering processes as said before. These will be dropped in the following lines code.</strong></p>
<div id="cell-160" class="cell" data-outputid="549470ed-c711-445b-dfe6-18fe0822a99d" data-execution_count="76">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>merged_df <span class="op">=</span> merged_df.drop(columns <span class="op">=</span> [<span class="st">'Nombre_de_personnes_de_18_à_24_ans'</span>,</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nombre_de_personnes_de_25_à_29_ans'</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nombre_de_personnes_de_30_ans_ou_plus'</span>,</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nombre_de_personnes_non_scolarisées_de_15_ans_ou_plus'</span>,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Abstentions'</span>, <span class="st">'Votants'</span>, <span class="st">'%_Vot/Ins'</span>, <span class="st">'Blancs'</span>, <span class="st">'%_Blancs/Vot'</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nuls'</span>, <span class="st">'%_Nuls/Vot'</span>, <span class="st">'Exprimés'</span>, <span class="st">'%_Exp/Vot'</span>,<span class="st">'Prénom'</span>, <span class="st">'%_Voix/Exp'</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Prénom.1'</span>, <span class="st">'%_Voix/Exp.1'</span>, <span class="st">'Prénom.2'</span>, <span class="st">'%_Voix/Exp.2'</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nom.3'</span>, <span class="st">'Prénom.3'</span>, <span class="st">'%_Voix/Exp.3'</span>, <span class="st">'Nom.4'</span>, <span class="st">'Prénom.4'</span>, <span class="st">'%_Voix/Exp.4'</span>,</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nom.5'</span>, <span class="st">'Prénom.5'</span>, <span class="st">'%_Voix/Exp.5'</span>, <span class="st">'Nom.6'</span>, <span class="st">'Prénom.6'</span>, <span class="st">'%_Voix/Exp.6'</span>,</span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nom.7'</span>, <span class="st">'Prénom.7'</span>, <span class="st">'%_Voix/Exp.7'</span>, <span class="st">'Nom.8'</span>, <span class="st">'Prénom.8'</span>, <span class="st">'%_Voix/Exp.8'</span>,</span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="st">'Nom.9'</span>, <span class="st">'Prénom.9'</span>, <span class="st">'%_Voix/Exp.9'</span>, <span class="st">'Nom.10'</span>, <span class="st">'Prénom.10'</span>, <span class="st">'%_Voix/Exp.10'</span>])</span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(merged_df.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['LIBCOM', 'CODGEO', 'Perc_aucun_diplôme_ou_au_plus_un_CEP', 'Perc_BEPC_brevet_des_collèges_DNB', "Perc_CAP_d'un_BEP_ou_équivalent", 'Perc_Baccalauréat_brevet_professionnel_ou_équivalent', 'Perc__Bac_+_2', 'Perc__Bac_+_3_ou_Bac_+_4', 'Perc__Bac_+_5_ou_plus', 'Pop_plus_15_ans_éligible_diplôme', 'Population', 'Perc_Pop_18-24_ans', 'Perc_Pop_25-39_ans', 'Perc_Pop_40-54_ans', 'Perc_Pop_55-64_ans', 'Perc_Pop_65-79_ans', 'Perc_Pop_80_ans_ou_plus', 'Perc_Agriculteurs_exploitants', 'Perc_Artisans_Comm._Chefs_entr.', 'Perc_Cadres_Prof._intel._sup.', 'Perc_Prof._intermédiaires', 'Perc_Employés', 'Perc_Ouvriers', 'Perc_Retraités', 'Pop_plus_15_ans_actifs', 'Pop_plus_18_ans', 'LIBDENS', 'Inscrits', '%_Abs/Ins', '%_Blancs/Ins', '%_Nuls/Ins', '%_Exp/Ins', 'Nom', 'Nom.1', 'Nom.2', 'Médiane_(€)']</code></pre>
</div>
</div>
</section>
<section id="descriptive-statistics" class="level1">
<h1>DESCRIPTIVE STATISTICS</h1>
<p><strong>Summary statistics of ‘Médiane_(€)’</strong></p>
<div id="cell-163" class="cell" data-outputid="c453c7dc-a4fa-49e5-c174-57dc75796ff4" data-execution_count="77">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>merged_df_dashbord[<span class="st">'Médiane_(€)'</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>count     30089
unique     1859
top       20150
freq         70
Name: Médiane_(€), dtype: int64</code></pre>
</div>
</div>
<p><strong>Summary statistics of education variables</strong></p>
<div id="cell-165" class="cell" data-execution_count="78">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>merged_df_dashbord[[<span class="st">'Perc_aucun_diplôme_ou_au_plus_un_CEP'</span>, <span class="st">'Perc_BEPC_brevet_des_collèges_DNB'</span>, <span class="st">"Perc_CAP_d'un_BEP_ou_équivalent"</span>, </span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Perc_Baccalauréat_brevet_professionnel_ou_équivalent'</span>, <span class="st">'Perc__Bac_+_2'</span>, <span class="st">'Perc__Bac_+_3_ou_Bac_+_4'</span>, <span class="st">'Perc__Bac_+_5_ou_plus'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="78">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</th>
<th data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</th>
<th data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_2</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>22.591922</td>
<td>5.641614</td>
<td>29.959675</td>
<td>17.782948</td>
<td>11.094970</td>
<td>7.373132</td>
<td>5.555739</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>7.094158</td>
<td>2.087077</td>
<td>5.223689</td>
<td>3.207195</td>
<td>3.263400</td>
<td>3.007270</td>
<td>3.964771</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>3.159558</td>
<td>0.000000</td>
<td>5.184786</td>
<td>3.205685</td>
<td>0.961538</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>17.424250</td>
<td>4.319037</td>
<td>26.805778</td>
<td>15.789474</td>
<td>8.767376</td>
<td>5.204531</td>
<td>3.092784</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>21.960784</td>
<td>5.445320</td>
<td>30.186061</td>
<td>17.664671</td>
<td>11.000000</td>
<td>7.042254</td>
<td>4.651163</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>27.053189</td>
<td>6.666667</td>
<td>33.405674</td>
<td>19.612591</td>
<td>13.294798</td>
<td>9.202454</td>
<td>6.878267</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>61.682583</td>
<td>27.826087</td>
<td>54.216867</td>
<td>46.224821</td>
<td>32.038835</td>
<td>26.470588</td>
<td>48.186528</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Summary statistics of the socio-professional categories</strong></p>
<div id="cell-167" class="cell" data-execution_count="79">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>merged_df_dashbord[[<span class="st">'Perc_Agriculteurs_exploitants'</span>, <span class="st">'Perc_Artisans_Comm._Chefs_entr.'</span>, <span class="st">'Perc_Cadres_Prof._intel._sup.'</span>, </span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'Perc_Prof._intermédiaires'</span>, <span class="st">'Perc_Employés'</span>, <span class="st">'Perc_Ouvriers'</span>, <span class="st">'Perc_Retraités'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="79">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Agriculteurs_exploitants</th>
<th data-quarto-table-cell-role="th">Perc_Artisans_Comm._Chefs_entr.</th>
<th data-quarto-table-cell-role="th">Perc_Cadres_Prof._intel._sup.</th>
<th data-quarto-table-cell-role="th">Perc_Prof._intermédiaires</th>
<th data-quarto-table-cell-role="th">Perc_Employés</th>
<th data-quarto-table-cell-role="th">Perc_Ouvriers</th>
<th data-quarto-table-cell-role="th">Perc_Retraités</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>3.145626</td>
<td>4.888106</td>
<td>6.843559</td>
<td>15.574086</td>
<td>17.662393</td>
<td>16.753625</td>
<td>35.132605</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>4.454574</td>
<td>3.528868</td>
<td>5.470495</td>
<td>6.697343</td>
<td>5.965316</td>
<td>7.437245</td>
<td>10.498721</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.000000</td>
<td>2.717391</td>
<td>3.200000</td>
<td>10.975610</td>
<td>14.061390</td>
<td>11.624650</td>
<td>28.116223</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>1.515152</td>
<td>4.371585</td>
<td>5.769231</td>
<td>15.449596</td>
<td>17.677165</td>
<td>16.129032</td>
<td>34.375000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>4.347826</td>
<td>6.493506</td>
<td>9.352518</td>
<td>19.999898</td>
<td>21.143571</td>
<td>21.153846</td>
<td>41.436360</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>51.724138</td>
<td>35.294118</td>
<td>46.666667</td>
<td>57.142857</td>
<td>64.346645</td>
<td>58.823529</td>
<td>94.736842</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Summary statistics of the age categories</strong></p>
<div id="cell-169" class="cell" data-execution_count="80">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>merged_df_dashbord[[<span class="st">'Perc_Pop_18-24_ans'</span>, <span class="st">'Perc_Pop_25-39_ans'</span>, <span class="st">'Perc_Pop_40-54_ans'</span>, <span class="st">'Perc_Pop_55-64_ans'</span>, <span class="st">'Perc_Pop_65-79_ans'</span>, <span class="st">'Perc_Pop_80_ans_ou_plus'</span>]].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="80">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Pop_18-24_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_25-39_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_40-54_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_55-64_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_65-79_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_80_ans_ou_plus</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
<td>30089.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>6.733697</td>
<td>20.515223</td>
<td>26.766579</td>
<td>18.421773</td>
<td>19.732625</td>
<td>7.830104</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>2.598317</td>
<td>5.379367</td>
<td>4.475644</td>
<td>3.479602</td>
<td>5.197122</td>
<td>3.751553</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.000000</td>
<td>0.000000</td>
<td>6.655992</td>
<td>3.370787</td>
<td>2.739726</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>5.118492</td>
<td>16.893733</td>
<td>23.863636</td>
<td>16.153858</td>
<td>16.141411</td>
<td>5.203234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>6.587457</td>
<td>20.359281</td>
<td>26.777617</td>
<td>18.137255</td>
<td>19.252548</td>
<td>7.174888</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>8.080891</td>
<td>23.896104</td>
<td>29.629630</td>
<td>20.390150</td>
<td>22.857143</td>
<td>9.706546</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>49.048577</td>
<td>47.540984</td>
<td>49.333333</td>
<td>37.354025</td>
<td>47.489237</td>
<td>46.612796</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Summary statistics of the qualitative variables of interest</strong></p>
<div id="cell-171" class="cell" data-outputid="694b8002-47a5-44f3-c3b2-c7b4105b07da" data-execution_count="81">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Descriptive statistics for qualitative variables</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>qualitative_variables <span class="op">=</span> merged_df_dashbord[[<span class="st">'LIBDENS'</span>, <span class="st">'Nom'</span>, <span class="st">'Nom.1'</span>, <span class="st">'Nom.2'</span>, <span class="st">'Nom'</span>, <span class="st">'Nom.1'</span>,</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">'Nom.2'</span>, <span class="st">'Nom.3'</span>, <span class="st">'Nom.4'</span>, <span class="st">'Nom.5'</span>, <span class="st">'Nom.6'</span>, <span class="st">'Nom.7'</span>,</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">'Nom.8'</span>, <span class="st">'Nom.9'</span>, <span class="st">'Nom.10'</span>]]</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>qualitative_stats <span class="op">=</span> qualitative_variables.describe()</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Basic descriptive statistics for qualitative variables:"</span>)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(qualitative_stats)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Frequence of occurence</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> qualitative_variables[[<span class="st">'LIBDENS'</span>, <span class="st">'Nom'</span>]].columns:</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Distribution des valeurs pour </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(merged_df_dashbord[col].value_counts())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Basic descriptive statistics for qualitative variables:
                         LIBDENS     Nom   Nom.1   Nom.2     Nom   Nom.1  \
count                      30089   30089   30089   30089   30089   30089   
unique                         7       7       8       8       7       8   
top     Rural à habitat dispersé  LE PEN  MACRON  MACRON  LE PEN  MACRON   
freq                       16501   16686    9697   10416   16686    9697   

         Nom.2      Nom.3          Nom.4  Nom.5   Nom.6   Nom.7    Nom.8  \
count    30089      30089          30089  30089   30089   30089    30089   
unique       8          9             10     11      11      10        9   
top     MACRON  MÉLENCHON  DUPONT-AIGNAN  HAMON  POUTOU  POUTOU  ARTHAUD   
freq     10416      12336          15807  15844    9346   10018     8699   

          Nom.9     Nom.10  
count     30089      30089  
unique        9          8  
top     ARTHAUD  CHEMINADE  
freq       8537      19085  

Distribution des valeurs pour LIBDENS:
LIBDENS
Rural à habitat dispersé          16501
Bourgs ruraux                      4844
Rural à habitat très dispersé      4774
Ceintures urbaines                 1876
Petites villes                      850
Grands centres urbains              733
Centres urbains intermédiaires      511
Name: count, dtype: int64

Distribution des valeurs pour Nom:
Nom
LE PEN           16686
MACRON            6262
FILLON            4343
MÉLENCHON         2732
LASSALLE            60
DUPONT-AIGNAN        3
HAMON                3
Name: count, dtype: int64

Distribution des valeurs pour Nom:
Nom
LE PEN           16686
MACRON            6262
FILLON            4343
MÉLENCHON         2732
LASSALLE            60
DUPONT-AIGNAN        3
HAMON                3
Name: count, dtype: int64</code></pre>
</div>
</div>
<p><em>We are suspicious of the education variables being correlated to the socio-professional variables. If these 2 types of variables are strongly correlated, we will take out one of the 2 from the study to avoid redundancies. To investigate, we will compute their correlation coefficients.</em></p>
<p><strong>Lets compute the correlation matrix of these variables</strong></p>
<div id="cell-175" class="cell" data-outputid="6afe7be6-a8ed-44d8-98a1-2af74876cbb5" data-execution_count="82">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We select the variables of interest for the correlation matrix</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>vcov <span class="op">=</span> [<span class="st">'Perc_aucun_diplôme_ou_au_plus_un_CEP'</span>,</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_BEPC_brevet_des_collèges_DNB'</span>,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_CAP_d</span><span class="ch">\'</span><span class="st">un_BEP_ou_équivalent'</span>,</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Baccalauréat_brevet_professionnel_ou_équivalent'</span>,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc__Bac_+_2'</span>,</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc__Bac_+_3_ou_Bac_+_4'</span>,</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc__Bac_+_5_ou_plus'</span>,</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Agriculteurs_exploitants'</span>,</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Artisans_Comm._Chefs_entr.'</span>,</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Cadres_Prof._intel._sup.'</span>,</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Prof._intermédiaires'</span>,</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Employés'</span>,</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Ouvriers'</span>,</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a> <span class="st">'Perc_Retraités'</span>]</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets build the correlation matrix</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>df_vcov <span class="op">=</span> merged_df[vcov].corr()</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>df_vcov</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="82">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</th>
<th data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</th>
<th data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_2</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</th>
<th data-quarto-table-cell-role="th">Perc_Agriculteurs_exploitants</th>
<th data-quarto-table-cell-role="th">Perc_Artisans_Comm._Chefs_entr.</th>
<th data-quarto-table-cell-role="th">Perc_Cadres_Prof._intel._sup.</th>
<th data-quarto-table-cell-role="th">Perc_Prof._intermédiaires</th>
<th data-quarto-table-cell-role="th">Perc_Employés</th>
<th data-quarto-table-cell-role="th">Perc_Ouvriers</th>
<th data-quarto-table-cell-role="th">Perc_Retraités</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</td>
<td>1.000000</td>
<td>0.114414</td>
<td>0.080363</td>
<td>-0.464383</td>
<td>-0.676148</td>
<td>-0.643083</td>
<td>-0.535443</td>
<td>0.146902</td>
<td>-0.120354</td>
<td>-0.471410</td>
<td>-0.457980</td>
<td>-0.069058</td>
<td>0.255437</td>
<td>0.374200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</td>
<td>0.114414</td>
<td>1.000000</td>
<td>-0.158648</td>
<td>-0.044816</td>
<td>-0.264051</td>
<td>-0.144053</td>
<td>-0.159246</td>
<td>0.051294</td>
<td>0.043100</td>
<td>-0.168826</td>
<td>-0.194655</td>
<td>-0.014927</td>
<td>-0.032530</td>
<td>0.207418</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</td>
<td>0.080363</td>
<td>-0.158648</td>
<td>1.000000</td>
<td>-0.182384</td>
<td>-0.292983</td>
<td>-0.525988</td>
<td>-0.590158</td>
<td>0.026313</td>
<td>-0.098408</td>
<td>-0.411812</td>
<td>-0.139645</td>
<td>0.121202</td>
<td>0.385250</td>
<td>-0.016200</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</td>
<td>-0.464383</td>
<td>-0.044816</td>
<td>-0.182384</td>
<td>1.000000</td>
<td>0.192989</td>
<td>0.147366</td>
<td>0.015256</td>
<td>0.067979</td>
<td>0.090110</td>
<td>0.040715</td>
<td>0.173215</td>
<td>0.095675</td>
<td>-0.074680</td>
<td>-0.192303</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc__Bac_+_2</td>
<td>-0.676148</td>
<td>-0.264051</td>
<td>-0.292983</td>
<td>0.192989</td>
<td>1.000000</td>
<td>0.484572</td>
<td>0.388083</td>
<td>-0.121602</td>
<td>0.054328</td>
<td>0.419225</td>
<td>0.476342</td>
<td>0.052632</td>
<td>-0.214894</td>
<td>-0.366652</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</td>
<td>-0.643083</td>
<td>-0.144053</td>
<td>-0.525988</td>
<td>0.147366</td>
<td>0.484572</td>
<td>1.000000</td>
<td>0.642944</td>
<td>-0.152482</td>
<td>0.125457</td>
<td>0.540299</td>
<td>0.387447</td>
<td>-0.053275</td>
<td>-0.394497</td>
<td>-0.196431</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</td>
<td>-0.535443</td>
<td>-0.159246</td>
<td>-0.590158</td>
<td>0.015256</td>
<td>0.388083</td>
<td>0.642944</td>
<td>1.000000</td>
<td>-0.163764</td>
<td>0.109549</td>
<td>0.687122</td>
<td>0.279842</td>
<td>-0.108570</td>
<td>-0.410991</td>
<td>-0.151056</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_Agriculteurs_exploitants</td>
<td>0.146902</td>
<td>0.051294</td>
<td>0.026313</td>
<td>0.067979</td>
<td>-0.121602</td>
<td>-0.152482</td>
<td>-0.163764</td>
<td>1.000000</td>
<td>-0.015747</td>
<td>-0.232363</td>
<td>-0.267886</td>
<td>-0.229532</td>
<td>-0.069923</td>
<td>0.052914</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc_Artisans_Comm._Chefs_entr.</td>
<td>-0.120354</td>
<td>0.043100</td>
<td>-0.098408</td>
<td>0.090110</td>
<td>0.054328</td>
<td>0.125457</td>
<td>0.109549</td>
<td>-0.015747</td>
<td>1.000000</td>
<td>0.018416</td>
<td>-0.070699</td>
<td>-0.107901</td>
<td>-0.215092</td>
<td>-0.080259</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_Cadres_Prof._intel._sup.</td>
<td>-0.471410</td>
<td>-0.168826</td>
<td>-0.411812</td>
<td>0.040715</td>
<td>0.419225</td>
<td>0.540299</td>
<td>0.687122</td>
<td>-0.232363</td>
<td>0.018416</td>
<td>1.000000</td>
<td>0.307922</td>
<td>-0.089912</td>
<td>-0.348322</td>
<td>-0.327255</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc_Prof._intermédiaires</td>
<td>-0.457980</td>
<td>-0.194655</td>
<td>-0.139645</td>
<td>0.173215</td>
<td>0.476342</td>
<td>0.387447</td>
<td>0.279842</td>
<td>-0.267886</td>
<td>-0.070699</td>
<td>0.307922</td>
<td>1.000000</td>
<td>0.008165</td>
<td>-0.190751</td>
<td>-0.530452</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_Employés</td>
<td>-0.069058</td>
<td>-0.014927</td>
<td>0.121202</td>
<td>0.095675</td>
<td>0.052632</td>
<td>-0.053275</td>
<td>-0.108570</td>
<td>-0.229532</td>
<td>-0.107901</td>
<td>-0.089912</td>
<td>0.008165</td>
<td>1.000000</td>
<td>0.060256</td>
<td>-0.435581</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Perc_Ouvriers</td>
<td>0.255437</td>
<td>-0.032530</td>
<td>0.385250</td>
<td>-0.074680</td>
<td>-0.214894</td>
<td>-0.394497</td>
<td>-0.410991</td>
<td>-0.069923</td>
<td>-0.215092</td>
<td>-0.348322</td>
<td>-0.190751</td>
<td>0.060256</td>
<td>1.000000</td>
<td>-0.337485</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Perc_Retraités</td>
<td>0.374200</td>
<td>0.207418</td>
<td>-0.016200</td>
<td>-0.192303</td>
<td>-0.366652</td>
<td>-0.196431</td>
<td>-0.151056</td>
<td>0.052914</td>
<td>-0.080259</td>
<td>-0.327255</td>
<td>-0.530452</td>
<td>-0.435581</td>
<td>-0.337485</td>
<td>1.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Looking at the correlation matrix is tough because we have too many variables. To fix it, lets make a heat map of the correlation matrix on absolute value.</strong></p>
<div id="cell-177" class="cell" data-outputid="83c91ccb-20e9-4975-a6af-aef0735e8f3a" data-execution_count="83">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>mask <span class="op">=</span> np.triu(np.ones_like(df_vcov, dtype<span class="op">=</span><span class="bu">bool</span>), k<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(<span class="bu">abs</span>(df_vcov), mask <span class="op">=</span> mask, cmap<span class="op">=</span><span class="st">'icefire'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-81-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>We can see only 11 strong correlations. Since the majority of the variables are lowly correlated, and since it would be intresting to interpret the cluster with respect to all these variables, we will keep all of them in our study.</em></p>
</section>
<section id="clustering-top-1-candidates" class="level1">
<h1>CLUSTERING : TOP 1 CANDIDATES</h1>
<p><em>We first want to make a clustering decomposition using as voting preferences the name of the candidate ending the elections with the highest number of votes in each commune</em></p>
<p><strong>Data preparation</strong></p>
<div id="cell-182" class="cell" data-execution_count="84">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> [<span class="st">'LIBCOM'</span>, <span class="st">'CODGEO'</span>, <span class="st">'Pop_plus_15_ans_éligible_diplôme'</span>,</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="st">'Population'</span>,  <span class="st">'Pop_plus_15_ans_actifs'</span>,<span class="st">'Pop_plus_18_ans'</span>, <span class="st">'Inscrits'</span>]</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We create a dataframe for the clustering analysis with all the variables of interest</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> merged_df.drop(columns<span class="op">=</span>var)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><em>We drop ‘LIBCOM’, ‘CODGEO’, ‘Pop_plus_15_ans_éligible_diplôme’, ‘Population’, ‘Pop_plus_15_ans_actifs’,‘Pop_plus_18_ans’ and ‘Inscrits’ from merged_df because irrelevant for the clustering analysis.</em></p>
<p><strong>Here is the list of variables kept for the clustering analysis</strong></p>
<div id="cell-185" class="cell" data-outputid="08d1d6f5-71a2-47bf-df34-f367a7b02815" data-execution_count="85">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(selected_columns.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Perc_aucun_diplôme_ou_au_plus_un_CEP', 'Perc_BEPC_brevet_des_collèges_DNB', "Perc_CAP_d'un_BEP_ou_équivalent", 'Perc_Baccalauréat_brevet_professionnel_ou_équivalent', 'Perc__Bac_+_2', 'Perc__Bac_+_3_ou_Bac_+_4', 'Perc__Bac_+_5_ou_plus', 'Perc_Pop_18-24_ans', 'Perc_Pop_25-39_ans', 'Perc_Pop_40-54_ans', 'Perc_Pop_55-64_ans', 'Perc_Pop_65-79_ans', 'Perc_Pop_80_ans_ou_plus', 'Perc_Agriculteurs_exploitants', 'Perc_Artisans_Comm._Chefs_entr.', 'Perc_Cadres_Prof._intel._sup.', 'Perc_Prof._intermédiaires', 'Perc_Employés', 'Perc_Ouvriers', 'Perc_Retraités', 'LIBDENS', '%_Abs/Ins', '%_Blancs/Ins', '%_Nuls/Ins', '%_Exp/Ins', 'Nom', 'Nom.1', 'Nom.2', 'Médiane_(€)']</code></pre>
</div>
</div>
<p><strong>What is the list of candidates that came first in the votings for a given commune</strong></p>
<div id="cell-187" class="cell" data-outputid="cf9d218b-48ee-42ff-c53f-eafcf32ab69b" data-execution_count="86">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>selected_columns[<span class="st">'Nom'</span>].unique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="86">
<pre><code>array(['LE PEN', 'MÉLENCHON', 'MACRON', 'FILLON', 'DUPONT-AIGNAN',
       'LASSALLE', 'HAMON'], dtype=object)</code></pre>
</div>
</div>
<p><em>One of ‘LE PEN’, ‘MÉLENCHON’, ‘MACRON’, ‘FILLON’, ‘DUPONT-AIGNAN’, ‘LASSALLE’ and ‘HAMON’ got the biggest number of votes in a given commune.</em></p>
<p><strong>Create candidates dummies</strong></p>
<div id="cell-190" class="cell" data-outputid="ce267d32-0506-4641-9900-2cc9dd388581" data-execution_count="87">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the dummies</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>dummies <span class="op">=</span> pd.get_dummies(selected_columns[<span class="st">'Nom'</span>], prefix<span class="op">=</span><span class="st">''</span>, prefix_sep<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatanate the dummies to selected_columns</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> pd.concat([selected_columns, dummies], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>selected_columns.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="87">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</th>
<th data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</th>
<th data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_2</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</th>
<th data-quarto-table-cell-role="th">Perc_Pop_18-24_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_25-39_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_40-54_ans</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">Nom.1</th>
<th data-quarto-table-cell-role="th">Nom.2</th>
<th data-quarto-table-cell-role="th">Médiane_(€)</th>
<th data-quarto-table-cell-role="th">DUPONT-AIGNAN</th>
<th data-quarto-table-cell-role="th">FILLON</th>
<th data-quarto-table-cell-role="th">HAMON</th>
<th data-quarto-table-cell-role="th">LASSALLE</th>
<th data-quarto-table-cell-role="th">LE PEN</th>
<th data-quarto-table-cell-role="th">MACRON</th>
<th data-quarto-table-cell-role="th">MÉLENCHON</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>19.202227</td>
<td>4.726960</td>
<td>33.489992</td>
<td>17.039008</td>
<td>12.865665</td>
<td>7.059242</td>
<td>5.616906</td>
<td>6.194843</td>
<td>18.261647</td>
<td>33.384666</td>
<td>...</td>
<td>MACRON</td>
<td>FILLON</td>
<td>23310</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>12.571429</td>
<td>4.000000</td>
<td>26.857143</td>
<td>21.714286</td>
<td>14.285714</td>
<td>11.428571</td>
<td>9.142857</td>
<td>4.419890</td>
<td>29.834254</td>
<td>27.624309</td>
<td>...</td>
<td>MACRON</td>
<td>FILLON</td>
<td>24290</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>21.746034</td>
<td>5.799080</td>
<td>27.586404</td>
<td>19.097301</td>
<td>12.184750</td>
<td>7.290866</td>
<td>6.295564</td>
<td>12.175313</td>
<td>28.070376</td>
<td>23.188594</td>
<td>...</td>
<td>MÉLENCHON</td>
<td>MACRON</td>
<td>19860</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>23.827058</td>
<td>4.488999</td>
<td>30.060158</td>
<td>17.943880</td>
<td>11.997821</td>
<td>6.928553</td>
<td>4.753531</td>
<td>7.383041</td>
<td>26.681287</td>
<td>27.266082</td>
<td>...</td>
<td>FILLON</td>
<td>MACRON</td>
<td>23370</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
<td>False</td>
<td>False</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>17.894737</td>
<td>4.210526</td>
<td>32.631579</td>
<td>31.578947</td>
<td>5.263158</td>
<td>5.263158</td>
<td>3.157895</td>
<td>7.368421</td>
<td>15.789474</td>
<td>29.473684</td>
<td>...</td>
<td>LE PEN</td>
<td>MACRON</td>
<td>23970</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>False</td>
<td>True</td>
</tr>
</tbody>
</table>

<p>5 rows × 36 columns</p>
</div>
</div>
</div>
<p><strong>Create urban density dummies</strong></p>
<div id="cell-192" class="cell" data-execution_count="88">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the urban density dummies</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>dummies_1 <span class="op">=</span> pd.get_dummies(selected_columns[<span class="st">'LIBDENS'</span>], prefix<span class="op">=</span><span class="st">''</span>, prefix_sep<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate the dummies to selected_columns</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> pd.concat([selected_columns, dummies_1], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Drop ‘LIBDENS’, ‘Nom’, ‘Nom.1’ and ‘Nom.2’ because non numeric (we need to keep only numeric variables for the clustering algorithm)</strong></p>
<div id="cell-194" class="cell" data-execution_count="89">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>selected_columns.drop([<span class="st">'LIBDENS'</span>, <span class="st">'Nom'</span>, <span class="st">'Nom.1'</span>, <span class="st">'Nom.2'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Here is the final list of variables</strong></p>
<div id="cell-196" class="cell" data-outputid="d17c2532-e1f7-4ef7-aa84-d7f59bbd523d" data-execution_count="90">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">list</span>(selected_columns.columns))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['Perc_aucun_diplôme_ou_au_plus_un_CEP', 'Perc_BEPC_brevet_des_collèges_DNB', "Perc_CAP_d'un_BEP_ou_équivalent", 'Perc_Baccalauréat_brevet_professionnel_ou_équivalent', 'Perc__Bac_+_2', 'Perc__Bac_+_3_ou_Bac_+_4', 'Perc__Bac_+_5_ou_plus', 'Perc_Pop_18-24_ans', 'Perc_Pop_25-39_ans', 'Perc_Pop_40-54_ans', 'Perc_Pop_55-64_ans', 'Perc_Pop_65-79_ans', 'Perc_Pop_80_ans_ou_plus', 'Perc_Agriculteurs_exploitants', 'Perc_Artisans_Comm._Chefs_entr.', 'Perc_Cadres_Prof._intel._sup.', 'Perc_Prof._intermédiaires', 'Perc_Employés', 'Perc_Ouvriers', 'Perc_Retraités', '%_Abs/Ins', '%_Blancs/Ins', '%_Nuls/Ins', '%_Exp/Ins', 'Médiane_(€)', 'DUPONT-AIGNAN', 'FILLON', 'HAMON', 'LASSALLE', 'LE PEN', 'MACRON', 'MÉLENCHON', 'Bourgs ruraux', 'Ceintures urbaines', 'Centres urbains intermédiaires', 'Grands centres urbains', 'Petites villes', 'Rural à habitat dispersé', 'Rural à habitat très dispersé']</code></pre>
</div>
</div>
<p><strong>We first need to normalise the scale of the observations</strong></p>
<div id="cell-198" class="cell" data-execution_count="91">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>data_scaled <span class="op">=</span> scaler.fit_transform(selected_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Elbow Method</strong></p>
<p><em>The following clustering method is based on the k-means caracterized by the following algorithm :</em></p>
<p><em>- Randomize and attribute K observations to K clusters</em></p>
<p><em>- Compute the distance (Euclidian or other) between the observations assigned and the remaining ones, and assign the closest individual to its closest group (cluster).</em></p>
<p><em>- Compute the centroid of each cluster as the mean of the individuals caracteristics (also called the average individual), and assign the closest individual to its closest group, and repeat it until having assigned a group to every individuals.</em></p>
<p><em>The optimal number of clusters K is chosen such that the inertia (the sum of the intra-group variances from 1 to K) starts decreasing at the same rate as the previous periods (at <span class="math inline">\(K\)</span> = <span class="math inline">\(K^*\)</span>, the optimal K).</em></p>
<p><em><span class="math display">\[ \text{Inertie} = \sum_{j=1}^{K} \sum_{x_i \in C_j}^{n_j} \| x_i - \mu_j \|^2 \]</span></em></p>
<p><em>Where K is the total number of clusters, <span class="math inline">\(n_j\)</span> the total number of observations in the cluster <span class="math inline">\(C_j\)</span>, <span class="math inline">\(\mu_j\)</span> the centroid of the cluster <span class="math inline">\(C_j\)</span>, and <span class="math inline">\(||x_i - \mu_j||^2\)</span> is the Euclidian distance put to the square between <span class="math inline">\(x_i\)</span> and <span class="math inline">\(\mu_j\)</span>.</em></p>
<div id="cell-201" class="cell" data-outputid="b0c0b8c5-608f-4517-908f-b415ea4f51ce" data-execution_count="92">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the inertial for each k (number of clusters)</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>inertia <span class="op">=</span> []</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>K_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">11</span>)  <span class="co"># Test for K to 1 to 10</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K_range:</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">0</span>).fit(data_scaled)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>    inertia.append(kmeans.inertia_)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the curve of the Elbow Method</span></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>plt.plot(K_range, inertia, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Elebow Method to Determine the Optimal Number of Clusters"</span>)</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Number of clusters (K)"</span>)</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Inertia"</span>)</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-90-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Given the change in the slope of the curve, the jump is at k=3. Hence, the optimal number of clusters is seems to be 3.</em></p>
<p><strong>We add to each observation the cluster’s number it belongs to</strong></p>
<div id="cell-204" class="cell" data-execution_count="93">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We define the number of clusters as 3</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">3</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>kmeans.fit(data_scaled)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We add the cluster label to merged_df (in which each observation's cluster number is provided)</span></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'Cluster'</span>] <span class="op">=</span> kmeans.labels_</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>selected_columns[<span class="st">'Cluster'</span>] <span class="op">=</span> kmeans.labels_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Lets have a look at it</strong></p>
<div id="cell-206" class="cell" data-outputid="a7447df1-811d-480d-fce1-89c7762d1294" data-execution_count="94">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>merged_df[[<span class="st">'CODGEO'</span>, <span class="st">'Cluster'</span>]].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="94">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">CODGEO</th>
<th data-quarto-table-cell-role="th">Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>01001</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>01002</td>
<td>0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>01004</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>01005</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>01006</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="summary-statistics-top-1-candidate" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics-top-1-candidate">SUMMARY STATISTICS : TOP 1 CANDIDATE</h2>
<section id="vote-preferences" class="level3">
<h3 class="anchored" data-anchor-id="vote-preferences"><strong>Vote preferences</strong></h3>
<p><strong>Proportion by cluster</strong></p>
<div id="cell-210" class="cell" data-outputid="c5f2b23c-98f3-4c85-c3a0-5a6429848b3a" data-execution_count="95">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="95">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">LE PEN</th>
<th data-quarto-table-cell-role="th">MÉLENCHON</th>
<th data-quarto-table-cell-role="th">MACRON</th>
<th data-quarto-table-cell-role="th">FILLON</th>
<th data-quarto-table-cell-role="th">LASSALLE</th>
<th data-quarto-table-cell-role="th">DUPONT-AIGNAN</th>
<th data-quarto-table-cell-role="th">HAMON</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.257617</td>
<td>0.088664</td>
<td>0.442599</td>
<td>0.210975</td>
<td>0.000000</td>
<td>0.000144</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.811566</td>
<td>0.045628</td>
<td>0.079200</td>
<td>0.063100</td>
<td>0.000505</td>
<td>0.000000</td>
<td>0.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.393106</td>
<td>0.159562</td>
<td>0.225491</td>
<td>0.215613</td>
<td>0.005691</td>
<td>0.000215</td>
<td>0.000322</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-212" class="cell" data-outputid="3bed1225-c6f0-4c7d-91c4-ea77c5843f4f" data-execution_count="96">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-213" class="cell" data-execution_count="97">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-95-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>The first cluster, <strong>Cluster 0</strong>, shows a strong preference for candidate Macron in the first round (he finished first in 44.3% of the communes in <strong>Cluster 0</strong>). We may assume, based on the results, that this cluster is center-right oriented, given that Fillon finished first in 21.1% and Le Pen in 25.8% of the communes.</p>
<p>On the other hand, <strong>Cluster 1</strong> demonstrated an almost absolute preference for Le Pen, with her finishing in first position in approximately 81.2% of the communes within this cluster. Based on the results, this cluster can be qualified as extrem-right - right.</p>
<p>The <strong>Cluster 2</strong> appears to be relatively balanced in terms of political preferences. Although Le Pen secured 39.3% of the communes, Macron and Fillon obtained 22.5% and 21.6%, respectively, while Mélenchon garnered 16%.</p>
</section>
<section id="age-categories" class="level3">
<h3 class="anchored" data-anchor-id="age-categories"><strong>Age Categories</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-217" class="cell" data-execution_count="98">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="98">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Pop_18-24_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_25-39_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_40-54_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_55-64_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_65-79_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_80_ans_ou_plus</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7.423219</td>
<td>22.023809</td>
<td>28.906829</td>
<td>17.941796</td>
<td>17.815971</td>
<td>5.888376</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>7.313497</td>
<td>22.746403</td>
<td>28.046373</td>
<td>17.781860</td>
<td>17.556451</td>
<td>6.555417</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5.358656</td>
<td>16.075082</td>
<td>23.271715</td>
<td>19.730403</td>
<td>24.394389</td>
<td>11.169754</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-219" class="cell" data-execution_count="99">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-220" class="cell" data-execution_count="100">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-98-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p><strong>Cluster 0</strong> is dominated by the population aged 40 to 54, making up 28.9% of the cluster, followed by those aged 25 to 39 at 22%. One noticeable aspect is the proportion of the youngest age group, representing 7.42%, the highest level compared to the other two clusters.</p>
<p><strong>Cluster 1</strong> is quite similar in age distribution, with a slightly higher proportion of elderly people at 6.56%, and a similar level for the 25-39 age group, but slightly lower for the youngest group.</p>
<p><strong>Cluster 2</strong> distinguishes itself from the other two clusters due to the size of its elderly population. In fact, this group is the largest, making up 24.4%, followed by the 40-54 group at 23.3%, which is lower than in the other two clusters. Finally, the youngest age group represents 5.36%, the lowest rate among all clusters.</p>
</section>
<section id="education-background" class="level3">
<h3 class="anchored" data-anchor-id="education-background"><strong>Education background</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-224" class="cell" data-outputid="0b135fd1-ebe5-4767-90da-4b2b77fc82fe" data-execution_count="101">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="101">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</th>
<th data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</th>
<th data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_2</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>15.640564</td>
<td>4.951616</td>
<td>25.927812</td>
<td>18.450933</td>
<td>14.250375</td>
<td>10.741176</td>
<td>10.037523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>22.867359</td>
<td>5.446504</td>
<td>32.164937</td>
<td>18.003853</td>
<td>10.955443</td>
<td>6.462978</td>
<td>4.098927</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>27.351191</td>
<td>6.444868</td>
<td>29.677873</td>
<td>16.957698</td>
<td>8.956176</td>
<td>6.222358</td>
<td>4.389837</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-226" class="cell" data-outputid="ef7c5637-7d56-41a8-b244-cbe7db41b5b2" data-execution_count="102">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-227" class="cell" data-execution_count="103">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-101-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>The highest rate of qualifications in <strong>Cluster 0</strong> is for practical job qualifications at 25.9%, which is the leading category across all clusters, though it has the lowest rate here. Cluster 0 distinguishes itself by having the highest rate of college diplomas for bachelor’s degrees (14.3% for Bac +2 and 10.7% for bac +3 or +4) and master’s degrees or higher (10%) compared to the other two clusters. It also has the lowest rate of individuals with no educational background.</p>
<p><strong>Clusters 1 and 2</strong> are relatively similar, with around 30% for practical job qualifications, followed by a high proportion of individuals with no diploma (22.9% for Cluster 1 and 27.4% for Cluster 2). The highest levels of education are also similar across both clusters, at around 4%.</p>
</section>
<section id="socio-professional-category" class="level3">
<h3 class="anchored" data-anchor-id="socio-professional-category"><strong>Socio professional category</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-231" class="cell" data-outputid="e0f54c76-6250-4de1-fb2c-cb148970f65b" data-execution_count="104">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Agriculteurs_exploitants</th>
<th data-quarto-table-cell-role="th">Perc_Artisans_Comm._Chefs_entr.</th>
<th data-quarto-table-cell-role="th">Perc_Cadres_Prof._intel._sup.</th>
<th data-quarto-table-cell-role="th">Perc_Prof._intermédiaires</th>
<th data-quarto-table-cell-role="th">Perc_Employés</th>
<th data-quarto-table-cell-role="th">Perc_Ouvriers</th>
<th data-quarto-table-cell-role="th">Perc_Retraités</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.637983</td>
<td>5.302653</td>
<td>12.891108</td>
<td>20.845556</td>
<td>17.157502</td>
<td>11.992155</td>
<td>30.173044</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2.593504</td>
<td>4.452825</td>
<td>5.591140</td>
<td>16.232519</td>
<td>19.642329</td>
<td>20.505930</td>
<td>30.981754</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>5.087844</td>
<td>5.227238</td>
<td>4.209389</td>
<td>10.675033</td>
<td>15.093112</td>
<td>14.713466</td>
<td>44.993918</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie chart by cluster</strong></p>
<div id="cell-233" class="cell" data-outputid="516934b1-2e4e-45be-8533-0eef6d60c010" data-execution_count="105">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-234" class="cell" data-execution_count="106">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-104-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p><strong>Cluster 0</strong> has the highest percentage of intellectual professions, at 12.9%, which was expected based on previous analyses showing the highest graduation rates. However, the distribution among other professional categories seems relatively balanced.*</p>
<p><strong>Cluster 1</strong> has the highest percentage of employees and workers. The dominant category is retirees up to 31%.*</p>
<p><strong>Cluster 2</strong> can be described as having the least active population, with nearly half of its population being retired, the highest percentage among all clusters. One noticeable aspect is the proportion of agricultural professions, which is the highest here at 5%.*</p>
</section>
<section id="urban-density" class="level3">
<h3 class="anchored" data-anchor-id="urban-density"><strong>Urban Density</strong></h3>
<p><strong>Proportion by Cluster</strong></p>
<div id="cell-238" class="cell" data-execution_count="107">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="107">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Bourgs ruraux</th>
<th data-quarto-table-cell-role="th">Ceintures urbaines</th>
<th data-quarto-table-cell-role="th">Centres urbains intermédiaires</th>
<th data-quarto-table-cell-role="th">Grands centres urbains</th>
<th data-quarto-table-cell-role="th">Petites villes</th>
<th data-quarto-table-cell-role="th">Rural à habitat dispersé</th>
<th data-quarto-table-cell-role="th">Rural à habitat très dispersé</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.209675</td>
<td>0.180072</td>
<td>0.017762</td>
<td>0.077112</td>
<td>0.037112</td>
<td>0.429603</td>
<td>0.048664</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.156451</td>
<td>0.036387</td>
<td>0.019565</td>
<td>0.012923</td>
<td>0.022092</td>
<td>0.699083</td>
<td>0.053498</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.131537</td>
<td>0.013422</td>
<td>0.012563</td>
<td>0.002148</td>
<td>0.030817</td>
<td>0.412649</td>
<td>0.396865</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-240" class="cell" data-execution_count="108">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-241" class="cell" data-execution_count="109">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-107-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>The <strong>Cluster 0</strong> is mainly characterized by urban areas, with a significant proportion of urban belts (18%) and large urban centers (7.71%), alongside notable presence in rural areas like bourgs ruraux (21%) and small towns (3.71%). This suggests that <strong>Cluster 0</strong> represents a mix of larger cities, their urban peripheries, and nearby rural areas, indicating that it encompasses both highly urbanized zones and smaller surrounding towns.</p>
<p>The <strong>Cluster 1</strong> stands out due to its predominance of rural areas with dispersed housing (69.9%), which dominates the cluster, while intermediate urban centers (1.96%) are present but much less significant. This indicates that <strong>Cluster 1</strong> is primarily rural, with small concentrations of urban areas, suggesting this cluster represents areas where population density is lower, and urbanization is weak.</p>
<p>The <strong>Cluster 2</strong> is defined by its strong concentration of highly dispersed rural areas (39.7%), coupled with rural areas with dispersed housing (41.3%). These figures highlight that <strong>Cluster 2</strong> is the most rural of all, with sparse populations spread across vast areas, indicating little to no urban influence in this cluster.</p>
</section>
<section id="median-disposable-income" class="level3">
<h3 class="anchored" data-anchor-id="median-disposable-income"><strong>Median disposable income</strong></h3>
<p><strong>Mean by cluster</strong></p>
<div id="cell-245" class="cell" data-outputid="bcdb2afd-a96e-4f0f-a096-6f554fd0a903" data-execution_count="110">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="110">
<pre><code>Cluster
0    24328.080866
1    20873.895026
2    19357.324171
Name: Médiane_(€), dtype: object</code></pre>
</div>
</div>
<p><strong>Bar charts</strong></p>
<div id="cell-247" class="cell" data-outputid="135eb37e-3834-4e44-d709-bb90b264b5ea" data-execution_count="111">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-248" class="cell" data-execution_count="112">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-110-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p><strong>Cluster 0</strong> has the highest mean median disposable income, around €24,328 .This result was expected given the professional and educational background of this cluster. This suggests that the communes in this cluster are relatively wealthier compared to the other clusters.</p>
<p><strong>Cluster 1</strong>, the median disposable income is €20,873.89, which is slightly below the mean median income of €21,519.77. This indicates a relatively average income level for the communes in this cluster.</p>
<p><strong>Cluster 2</strong> has the lowest median disposable income with 19,357 € , which is not surprising, considering that the average proportion of retired people in this cluster is about 45%, the highest among all clusters.</p>
</section>
<section id="number-of-communes-in-each-cluster" class="level3">
<h3 class="anchored" data-anchor-id="number-of-communes-in-each-cluster">Number of communes in each cluster</h3>
<div id="cell-251" class="cell" data-outputid="d0d0ce66-9b36-46d2-f7f8-5c525030ddd6" data-execution_count="113">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To count the number of towns in each cluster</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>count_per_cluster <span class="op">=</span> selected_columns.groupby(<span class="st">'Cluster'</span>).size()</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count_per_cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster
0     6925
1    13851
2     9313
dtype: int64</code></pre>
</div>
</div>
<p><em>The cluster seem to be balanced with a high number of communes in each of them.</em></p>
</section>
</section>
<section id="map-top-1-candidates-clustering" class="level2">
<h2 class="anchored" data-anchor-id="map-top-1-candidates-clustering">MAP : TOP 1 CANDIDATES CLUSTERING</h2>
<p><em>In order to get an overview of each town’s assignment to a cluster, a plot of French towns by cluster is created.</em></p>
<div id="cell-255" class="cell" data-outputid="f7dbecf0-9c1f-4c44-dfe5-88013c242de4" data-execution_count="114">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Importing the France map</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> requests.get(<span class="st">"https://raw.githubusercontent.com/gregoiredavid/france-geojson/master/communes.geojson"</span>)</span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>geojson_data_commune <span class="op">=</span> res.json()</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization with Plotly</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.choropleth_mapbox(</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a>    merged_df,</span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>    geojson<span class="op">=</span> geojson_data_commune,</span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"Cluster"</span>,</span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>    locations<span class="op">=</span><span class="st">"CODGEO"</span>,</span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>    featureidkey<span class="op">=</span><span class="st">"properties.code"</span>,</span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>{<span class="st">"lat"</span>: <span class="dv">47</span>, <span class="st">"lon"</span>: <span class="dv">2</span>},</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a>    mapbox_style<span class="op">=</span><span class="st">"carto-positron"</span>,</span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>    zoom<span class="op">=</span><span class="fl">5.2</span>,</span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>    hover_data<span class="op">=</span>[<span class="st">'LIBCOM'</span>, <span class="st">'Cluster'</span>, <span class="st">'Médiane_(€)'</span>,<span class="st">'Nom'</span>],</span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span>px.colors.diverging.RdYlGn</span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the margins of the map</span></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span>{<span class="st">"r"</span>:<span class="dv">0</span>,<span class="st">"t"</span>:<span class="dv">0</span>,<span class="st">"l"</span>:<span class="dv">0</span>,<span class="st">"b"</span>:<span class="dv">0</span>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p><strong>Save the map in HTML format</strong></p>
<div id="cell-257" class="cell" data-execution_count="115">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the map</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>output_path_html <span class="op">=</span> os.path.join(dir_html, <span class="st">"map_top1.html"</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>pio.write_html(fig, <span class="bu">file</span><span class="op">=</span>output_path_html)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>The map will be saved in our folder because the notebook in HTML format cannot display it.</strong></p>
<div id="cell-259" class="cell" data-execution_count="116">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'You will find the map following the path </span><span class="sc">{</span>dir_html<span class="sc">}</span><span class="ss"> under the name "map_top1.html"'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You will find the map following the path /Users/waelbenhamouda/Documents/Master 2/Python Programming/Python Project/HTML under the name "map_top1.html"</code></pre>
</div>
</div>
<p><strong>Comments</strong></p>
<p><em>The plot provides an overview of the cluster distribution across French territory, based on voting preferences, disposable income, and educational levels.</em></p>
<p><em>It can be highlighted that the cities belonging to Cluster 0 are predominantly metropolises and their suburban belt. This result is not surprising, given the previous analysis. For instance, the median disposable income is higher in this cluster, and the population tends to have higher levels of education. This cluster shows strong support for candidate Macron (center-right).</em></p>
<p><em>Cluster 1 is more rural and closer to the suburban belt. On average, it has the highest proportion of employees and workers. This cluster shows a quasi abolute preference for the far-right candidate, Le Pen.</em></p>
<p><em>Cluster 2 is largely associated with rural areas, according to the graph. On average, a significant proportion of the population is retired, and political preferences are relatively balanced between candidates, although Le Pen has the highest support within this cluster.</em></p>
</section>
<section id="clustering-top1---conclusion" class="level2">
<h2 class="anchored" data-anchor-id="clustering-top1---conclusion"><strong>Clustering top1 - Conclusion</strong></h2>
<p><em>Cluster 0 reflects a center-right leaning, with Macron leading, followed by strong support for Fillon and Le Pen. This cluster represents more urban areas, where middle-aged populations are dominant. From an education levels its show a higher education qualifications. It also has a notable representation of retirees and workers.</em></p>
<p><em>Cluster 1 is heavily dominated by Le Pen’s far-right vote, indicating a right-leaning cluster, with older populations primarily residing in rural areas close to the surban belt. Retirees make up the largest proportion, with an active population dominated by employees and worker classes. This suggests an economically weaker, rural demographic with lower levels of higher education diploma.</em></p>
<p><em>Cluster 2 presents a balanced political landscape, with Le Pen leading but also strong centrist and left-wing representation. This cluster is more rural, with a significant percentage of retirees and lower education levels, indicating a demographic of older living in dispersed rural areas.</em></p>
</section>
</section>
<section id="clustering-top-3-candidates" class="level1">
<h1>CLUSTERING : TOP 3 CANDIDATES</h1>
<p><em>Previously, only the candidate who came in first place in the first round was considered. Now, we aim to extend the analysis by examining the top 3 candidates (ordered from the 1st position to the 3rd) for each city to gain a deeper understanding of voting patterns.</em></p>
<p><strong>Data preparation</strong></p>
<div id="cell-265" class="cell" data-execution_count="117">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co">#The dummies for each candidate from previous are deleted</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>selected_columns.drop([<span class="st">'DUPONT-AIGNAN'</span>, <span class="st">'FILLON'</span>, <span class="st">'HAMON'</span>, <span class="st">'LASSALLE'</span>, <span class="st">'LE PEN'</span>, <span class="st">'MACRON'</span>,</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">'MÉLENCHON'</span>, <span class="st">'Cluster'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We create the Top 3 variables assembling “Nom”, “Nom.1” and ’Nom.2”</strong></p>
<div id="cell-267" class="cell" data-execution_count="118">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creation of the TOP3 variable</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>selected_columns[<span class="st">'Top3'</span>] <span class="op">=</span> merged_df[<span class="st">'Nom'</span>] <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> merged_df[<span class="st">'Nom.1'</span>] <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> merged_df[<span class="st">'Nom.2'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Creation of the Top 3 dummy variables</strong></p>
<div id="cell-269" class="cell" data-execution_count="119">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creation of dummies for each top3</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>dummies_top3 <span class="op">=</span> pd.get_dummies(selected_columns[<span class="st">'Top3'</span>], prefix<span class="op">=</span><span class="st">''</span>, prefix_sep<span class="op">=</span><span class="st">''</span>)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> pd.concat([selected_columns, dummies_top3], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>selected_columns.drop([<span class="st">'Top3'</span>], axis<span class="op">=</span><span class="dv">1</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>We first need to normalise the scale of the observations</strong></p>
<div id="cell-271" class="cell" data-execution_count="120">
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scaled the data to launch the clustering</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>data_scaled <span class="op">=</span> scaler.fit_transform(selected_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Optimal number of clusters</strong></p>
<div id="cell-273" class="cell" data-outputid="42e93252-0ffa-4f81-cefb-95463432bce9" data-execution_count="121">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Computation of the inertia</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>inertia <span class="op">=</span> []</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>K_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">20</span>)  <span class="co"># Testing for K between 1 and 20</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> k <span class="kw">in</span> K_range:</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">0</span>).fit(data_scaled)</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    inertia.append(kmeans.inertia_)</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>plt.plot(K_range, inertia, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Méthode du coude pour déterminer le nombre optimal de clusters"</span>)</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Nombre de clusters (K)"</span>)</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Inertie"</span>)</span>
<span id="cb160-14"><a href="#cb160-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-119-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><em>Given the change in the slope, we will consider that the optimal number of clusters is 4.</em></p>
<p><strong>K-means clustering</strong></p>
<div id="cell-276" class="cell" data-execution_count="122">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># K-Means</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>kmeans.fit(data_scaled)</span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding the results into merged ans selected columns dataframe</span></span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a>merged_df[<span class="st">'Cluster_top3'</span>] <span class="op">=</span> kmeans.labels_</span>
<span id="cb161-7"><a href="#cb161-7" aria-hidden="true" tabindex="-1"></a>selected_columns[<span class="st">'Cluster_top3'</span>] <span class="op">=</span> kmeans.labels_</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="summary-statistics-top-3-candidates" class="level2">
<h2 class="anchored" data-anchor-id="summary-statistics-top-3-candidates">SUMMARY STATISTICS : TOP 3 CANDIDATES</h2>
<section id="vote-preferences-1" class="level3">
<h3 class="anchored" data-anchor-id="vote-preferences-1"><strong>Vote preferences</strong></h3>
<p><strong>Given the large number of combinations when considering the Top 3 voting preferences, we created a score to quantify the voting preferences of the communes. The candidate gets 3 points in his score if he is first in the voting ranking, 2 points if he is second, 1 point if he is third</strong></p>
<div id="cell-280" class="cell" data-outputid="e72b2311-fb60-42af-9673-479b8e48740c" data-execution_count="123">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Cluster_top3</th>
<th data-quarto-table-cell-role="th">Score_LE PEN</th>
<th data-quarto-table-cell-role="th">Score_MÉLENCHON</th>
<th data-quarto-table-cell-role="th">Score_MACRON</th>
<th data-quarto-table-cell-role="th">Score_FILLON</th>
<th data-quarto-table-cell-role="th">Score_DUPONT-AIGNAN</th>
<th data-quarto-table-cell-role="th">Score_LASSALLE</th>
<th data-quarto-table-cell-role="th">Score_HAMON</th>
<th data-quarto-table-cell-role="th">Score_ASSELINEAU</th>
<th data-quarto-table-cell-role="th">Score_POUTOU</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>0</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-281" class="cell" data-outputid="516aa542-dc69-4a78-8d9d-aed9d96601e7" data-execution_count="124">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-122-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-122-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-122-output-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-122-output-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>The first cluster, <strong>Cluster 0</strong>, displays a relatively balanced voting preference. Macron leads with 14k points, followed by Le Pen at 11k points, and Fillon with around 10k points. This cluster appears to be politically diverse, suggesting a center-right to right-leaning electorate.</p>
<p>In contrast, <strong>Cluster 1</strong> is dominated by Le Pen, who secured close to 20k points. Both Macron and Fillon follow with approximately 16k points each, reflecting a strong competition between far-right and centrist candidates. Mélenchon holds a solid base of support but is overshadowed by the dominant figures of Le Pen, Macron, and Fillon. The results indicate that <strong>Cluster 1</strong> is strongly right-oriented, with a clear preference for far-right ideologies.</p>
<p>The <strong>Cluster 2</strong> demonstrates a decisive preference for Le Pen, who accumulated over 38k points, significantly outpacing other candidates. Macron and Fillon each earned around 22k and 21k points respectively, while Mélenchon also shows strong support. This cluster highlights a more polarized voting behavior, with a heavy inclination toward far-right but also notable centrist and left-leaning support, indicating diverse political dynamics.</p>
<p>Finally, <strong>Cluster 3</strong> stands out due to Lassalle’s unexpected lead, with 27 points, surpassing even mainstream candidates like Fillon, who earned 18 points. Unlike the previous clusters, Le Pen and Macron do not dominate, showing lower scores. The success of Lassalle suggests that <strong>Cluster 3</strong> may represent rural areas or regions where alternative political figures gained traction, deviating from the broader national patterns observed in the other clusters.</p>
</section>
<section id="age-categories-1" class="level3">
<h3 class="anchored" data-anchor-id="age-categories-1"><strong>Age Categories</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-285" class="cell" data-execution_count="125">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="125">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Pop_18-24_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_25-39_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_40-54_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_55-64_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_65-79_ans</th>
<th data-quarto-table-cell-role="th">Perc_Pop_80_ans_ou_plus</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster_top3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7.527421</td>
<td>21.979537</td>
<td>28.905764</td>
<td>17.951380</td>
<td>17.781065</td>
<td>5.854833</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.416001</td>
<td>16.158706</td>
<td>23.271002</td>
<td>19.691845</td>
<td>24.323065</td>
<td>11.139381</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>7.257895</td>
<td>22.765827</td>
<td>28.141369</td>
<td>17.786391</td>
<td>17.543709</td>
<td>6.504809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>6.615042</td>
<td>17.856825</td>
<td>27.802005</td>
<td>16.993945</td>
<td>21.397517</td>
<td>9.334667</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-287" class="cell" data-execution_count="126">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-288" class="cell" data-execution_count="127">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-125-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>In <strong>Cluster 0</strong>, the largest age group is between 40 and 54 years old, 28.9% of the population. The population aged 25 to 39 also makes up a considerable portion (22%), followed by those aged 55 to 64 (18%). The younger population, aged between 18 and 24, is the smallest group, representing only 7.53%.</p>
<p>In <strong>Cluster 1</strong>, the dominant age group is again those aged between 65 and 79, making up 24.3% of the population. The younger group, aged 55 to 64, is also significant, at 19.7%. The cluster shows a more balanced distribution across age groups compared to <strong>Cluster 0</strong>, with a notable representation of the population over 40 to 65, which accounts for 23.3%.</p>
<p><strong>Cluster 2 and 3</strong>, have similar distribution. The 40 to 54 age group dominate, aroud 28 % of the population, following by elderly population (65 to 79 years old), respectively at 17,5 and 21.4% . The 25 to 39 age group also holds a significant share, while the youngest group is underrepresented.</p>
</section>
<section id="education-background-1" class="level3">
<h3 class="anchored" data-anchor-id="education-background-1"><strong>Education background</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-292" class="cell" data-execution_count="128">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="128">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_aucun_diplôme_ou_au_plus_un_CEP</th>
<th data-quarto-table-cell-role="th">Perc_BEPC_brevet_des_collèges_DNB</th>
<th data-quarto-table-cell-role="th">Perc_CAP_d'un_BEP_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc_Baccalauréat_brevet_professionnel_ou_équivalent</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_2</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_3_ou_Bac_+_4</th>
<th data-quarto-table-cell-role="th">Perc__Bac_+_5_ou_plus</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster_top3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>15.474795</td>
<td>4.936448</td>
<td>25.538031</td>
<td>18.358285</td>
<td>14.351498</td>
<td>10.918914</td>
<td>10.422028</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>27.600792</td>
<td>6.447111</td>
<td>29.701225</td>
<td>16.875096</td>
<td>8.897125</td>
<td>6.147052</td>
<td>4.331600</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>22.423768</td>
<td>5.419806</td>
<td>32.097903</td>
<td>18.129395</td>
<td>11.110266</td>
<td>6.612630</td>
<td>4.206232</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>22.803544</td>
<td>4.519230</td>
<td>31.953334</td>
<td>20.924158</td>
<td>9.486728</td>
<td>5.946213</td>
<td>4.366793</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts by cluster</strong></p>
<div id="cell-294" class="cell" data-outputid="876c4f65-d5e1-43c1-a249-3d8ce4880b8e" data-execution_count="129">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-295" class="cell" data-execution_count="130">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-128-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p><strong>Cluster 0</strong> has the strongest educational background, with the highest rate of college diplomas: 10.9% for bachelor’s degrees and 10.4% for master’s degrees. It also has the lowest rates of individuals with no educational background (15.5%) and practical job qualifications (25.5%) compared to the other clusters.</p>
<p><strong>Clusters 1, 2, and 3</strong> have relatively similar distributions. The educational background is dominated by practical job qualifications, with rates ranging from 30% to 32%. The second highest rate is for individuals with no education. College education is less common compared to Cluster 0, with master’s degrees representing around 4% and bachelor’s degrees around 6%.</p>
</section>
<section id="socio-profesional-category" class="level3">
<h3 class="anchored" data-anchor-id="socio-profesional-category"><strong>Socio profesional category</strong></h3>
<p><strong>Average proportion by cluster</strong></p>
<div id="cell-299" class="cell" data-execution_count="131">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="131">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Perc_Agriculteurs_exploitants</th>
<th data-quarto-table-cell-role="th">Perc_Artisans_Comm._Chefs_entr.</th>
<th data-quarto-table-cell-role="th">Perc_Cadres_Prof._intel._sup.</th>
<th data-quarto-table-cell-role="th">Perc_Prof._intermédiaires</th>
<th data-quarto-table-cell-role="th">Perc_Employés</th>
<th data-quarto-table-cell-role="th">Perc_Ouvriers</th>
<th data-quarto-table-cell-role="th">Perc_Retraités</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster_top3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1.491730</td>
<td>5.315000</td>
<td>13.420673</td>
<td>20.978089</td>
<td>17.021529</td>
<td>11.682859</td>
<td>30.090121</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5.007322</td>
<td>5.163146</td>
<td>4.182934</td>
<td>10.678016</td>
<td>15.118737</td>
<td>14.938564</td>
<td>44.911280</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2.635923</td>
<td>4.514134</td>
<td>5.690098</td>
<td>16.433250</td>
<td>19.645472</td>
<td>20.221539</td>
<td>30.859583</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>12.851897</td>
<td>6.327289</td>
<td>4.231040</td>
<td>9.260916</td>
<td>10.670385</td>
<td>11.618396</td>
<td>45.040077</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie chart by cluster</strong></p>
<div id="cell-301" class="cell" data-outputid="a6e7ea99-63c6-4bd4-c3b7-fc0aebea8806" data-execution_count="132">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-302" class="cell" data-execution_count="133">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-131-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p><strong>Cluster 0</strong> has the highest rate of intellectual professions, which is consistent with its strong educational background, particularly the high rate of college graduates. Even though retirees make up 30% of the population in this cluster, it has the lowest overall retirement rate, suggesting a more active population. Additionally, it has one of the lowest rates of working-class individuals and the lowest rate of agricultural professions.</p>
<p><strong>Clusters 1 and 3</strong> have similar populations, heavily dominated by retirees, who represent around 45% of the population. However, Cluster 3 can be characterized as more rural, with a significant proportion of agricultural workers, the highest rate at around 13%. The remaining population is mostly composed of employees and the working class.</p>
<p><strong>Cluster 2</strong> has a similar retiree rate to Cluster 0. The population is relatively balanced between intermediate professions, the working class, and employees.</p>
</section>
<section id="urban-density-1" class="level3">
<h3 class="anchored" data-anchor-id="urban-density-1"><strong>Urban Density</strong></h3>
<p><strong>Proportion by cluster</strong></p>
<div id="cell-306" class="cell" data-execution_count="134">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="134">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Bourgs ruraux</th>
<th data-quarto-table-cell-role="th">Ceintures urbaines</th>
<th data-quarto-table-cell-role="th">Centres urbains intermédiaires</th>
<th data-quarto-table-cell-role="th">Grands centres urbains</th>
<th data-quarto-table-cell-role="th">Petites villes</th>
<th data-quarto-table-cell-role="th">Rural à habitat dispersé</th>
<th data-quarto-table-cell-role="th">Rural à habitat très dispersé</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">Cluster_top3</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.211954</td>
<td>0.198549</td>
<td>0.018294</td>
<td>0.083268</td>
<td>0.038953</td>
<td>0.403722</td>
<td>0.045261</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.133748</td>
<td>0.013596</td>
<td>0.014755</td>
<td>0.002846</td>
<td>0.031092</td>
<td>0.415051</td>
<td>0.388912</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.156550</td>
<td>0.034243</td>
<td>0.017893</td>
<td>0.012490</td>
<td>0.021613</td>
<td>0.701705</td>
<td>0.055505</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.333333</td>
<td>0.666667</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p><strong>Pie charts</strong></p>
<div id="cell-308" class="cell" data-execution_count="135">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<div id="cell-309" class="cell" data-execution_count="136">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-134-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>The <strong>Cluster 0</strong> is characterized by a mix of bourgs ruraux (21.2%), urban belts (19.9%), small towns (3.9%), and the highest share of large urban centers (8.33%) compared to the other clusters. This cluster captures a blend of rural and semi-urban regions, with influence from larger urban areas.</p>
<p>The <strong>Cluster 1</strong> is primarily rural, with a presence of rural areas with very dispersed housing (38.9%) and rural areas with dispersed housing (41.5%). This indicates that the population is spread across wide, low-density areas.</p>
<p>The <strong>Cluster 2</strong> is also predominantly rural, defined by rural areas with dispersed housing (70.2%), highlighting its low-density rural nature.</p>
<p>The <strong>Cluster 3</strong> stands out for its dominance of rural areas with very dispersed housing (66.7%) and rural areas with dispersed housing (33.3%), making it a highly rural cluster with sparse populations.</p>
</section>
<section id="median-disposible-income" class="level3">
<h3 class="anchored" data-anchor-id="median-disposible-income"><strong>Median disposible income</strong></h3>
<p><strong>Mean by cluster</strong></p>
<div id="cell-313" class="cell" data-execution_count="137">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="137">
<pre><code>Cluster_top3
0    24565.331967
1    19340.086425
2    20941.449021
3    18548.888889
Name: Médiane_(€), dtype: object</code></pre>
</div>
</div>
<p><strong>Bar chart by cluster</strong></p>
<div id="cell-315" class="cell" data-outputid="9918e075-a346-4f3e-f9ba-94d572e92e5b" data-execution_count="138">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p><strong>We need to save and re-open the picture in order to display it in our HTML notebook</strong></p>
<div id="cell-317" class="cell" data-execution_count="139">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the image</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>fig.write_image(<span class="ss">f'</span><span class="sc">{</span>dir_figures<span class="sc">}</span><span class="ss">/pie_inc_top3.png'</span>)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Open the image</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> Image.<span class="bu">open</span>(<span class="ss">f'</span><span class="sc">{</span>dir_figures<span class="sc">}{</span><span class="st">'/pie_inc_top3.png'</span><span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the image</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a>plt.imshow(img)</span>
<span id="cb188-9"><a href="#cb188-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="python_project_files/figure-html/cell-137-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p><strong>Comments</strong></p>
<p>In <strong>Cluster 0</strong>, the median disposable income is the highest, at €24,565.33. This result is consistent with the previous analysis. For instance, this cluster has the highest rate of intellectual professions. Moreover, it has also been suggested that the population is more urban.</p>
<p>For <strong>Cluster 2</strong>, the median disposable income rises to €20,914.45, placing this cluster slightly above the overall mean. This cluster seems to have a more balanced income distribution.</p>
<p><strong>Cluster 3</strong> has the lowest median disposable income at €18,548.89. This was expected, given that it has a more rural population—15% are in agricultural professions, and around 45% of the population is retired.</p>
<p>Finally, <strong>Cluster 1</strong> has a median disposable income similar to Cluster 3. This can also be related to the fact that this population is mostly retired</p>
</section>
<section id="number-of-communes-in-each-cluster-1" class="level3">
<h3 class="anchored" data-anchor-id="number-of-communes-in-each-cluster-1"><strong>Number of communes in each cluster</strong></h3>
<div id="cell-320" class="cell" data-outputid="b37bcd40-f929-4204-b537-44b4361636cd" data-execution_count="140">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To count the number of towns in each cluster</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>count_per_cluster_top3 <span class="op">=</span> selected_columns.groupby(<span class="st">'Cluster_top3'</span>).size()</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(count_per_cluster_top3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cluster_top3
0     6341
1     9488
2    14251
3        9
dtype: int64</code></pre>
</div>
</div>
<p>*The clusters seem to be balanced, except for <strong>Cluster 3</strong> that contains only 9 communes**</p>
</section>
</section>
<section id="map-top-3-candidates-clustering" class="level2">
<h2 class="anchored" data-anchor-id="map-top-3-candidates-clustering">MAP : TOP 3 CANDIDATES CLUSTERING</h2>
<p><em>In order to get an overview of each town’s assignment to a cluster, a plot of French towns by cluster is created.</em></p>
<div id="cell-324" class="cell" data-outputid="3d43a0da-cb65-4f84-9351-cbe6fdabd327" data-execution_count="141">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualization with Plotly</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.choropleth_mapbox(</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>    merged_df,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>    geojson<span class="op">=</span> geojson_data_commune,</span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">"Cluster_top3"</span>,</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>    locations<span class="op">=</span><span class="st">"CODGEO"</span>,</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a>    featureidkey<span class="op">=</span><span class="st">"properties.code"</span>,</span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span>{<span class="st">"lat"</span>: <span class="dv">47</span>, <span class="st">"lon"</span>: <span class="dv">2</span>},</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a>    mapbox_style<span class="op">=</span><span class="st">"carto-positron"</span>,</span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a>    zoom<span class="op">=</span><span class="fl">5.2</span>,</span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>    hover_data<span class="op">=</span>[<span class="st">'LIBCOM'</span>, <span class="st">'Cluster_top3'</span>],</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a>    color_continuous_scale<span class="op">=</span>px.colors.diverging.RdYlGn</span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajuster les marges de la carte</span></span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>fig.update_layout(margin<span class="op">=</span>{<span class="st">"r"</span>:<span class="dv">0</span>,<span class="st">"t"</span>:<span class="dv">0</span>,<span class="st">"l"</span>:<span class="dv">0</span>,<span class="st">"b"</span>:<span class="dv">0</span>})</span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the figure</span></span>
<span id="cb191-19"><a href="#cb191-19" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>Unable to display output for mime type(s): application/vnd.plotly.v1+json</code></pre>
</div>
</div>
<p><strong>Save the map in HTML format</strong></p>
<div id="cell-326" class="cell" data-execution_count="142">
<div class="cell-output cell-output-stdout">
<pre><code>This cell will not be displayed in the HTML</code></pre>
</div>
</div>
<p><strong>The map will be saved in our folder because the notebook in HTML format cannot display it.</strong></p>
<div id="cell-328" class="cell" data-execution_count="143">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'You will find the map following the path </span><span class="sc">{</span>dir_html<span class="sc">}</span><span class="ss"> under the name "map_top3.html"'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>You will find the map following the path /Users/waelbenhamouda/Documents/Master 2/Python Programming/Python Project/HTML under the name "map_top3.html"</code></pre>
</div>
</div>
</section>
<section id="clustering-top3---conclusion" class="level2">
<h2 class="anchored" data-anchor-id="clustering-top3---conclusion"><strong>Clustering top3 - Conclusion</strong></h2>
<p>The <strong>Cluster 0</strong> can be qualified as center-right, with a vote preference in favor of candidate Macron in the first round. The result obtained is relatively similar to the first cluster analysis. In fact, this population is more urban and has on average the highest rate for college diplomas, leading on average to the highest median disposable income.</p>
<p><strong>Cluster 1</strong> is right-leaning, dominated by Le Pen, with competitive support from Macron and Fillon. This cluster has a strong presence of retirees and a relatively rural population.</p>
<p><strong>Cluster 2</strong> has a strong far-right inclination with a heavy preference for Le Pen. It is highly rural, with low-density populations, and the active population is mostly from the working class, intermediate professions, and employees.</p>
<p>Finally, <strong>Cluster 3</strong> is characterized by a strict preference for Lassalle, which is entirely consistent with the analysis. It has the lowest income levels, high retiree percentages, and low urban influences. The population is mostly from a rural background, values defended by this candidate.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>CONCLUSION</h1>
<ul>
<li><p>The two clustering approaches provide valuable insights into the socio-political landscape of the communes. Clustering top1, focusing on first-place candidates, highlights clear political preferences tied to economic conditions and urbanization levels, with Cluster 0 representing urbanized areas, Cluster 1 showcasing far-right suburban-rural region.and Cluster 2 featuring more balanced preferences in a highly rural environment.</p></li>
<li><p>In Clustering Top 3, we delve deeper into the cumulative voting preferences by considering the top 3 candidates and creating a score. This reveals greater political diversity within regions. Cluster 0 continues to show a center-right political influence localized in urban areas. Cluster 2 is relatively rural and exhibits a near-absolute preference for Le Pen, while Cluster 1 is a suburban-rural region with a preference for Le Pen and relatively balanced support for other right and center-right candidates. Finally, Cluster 3, which has the highest rural background in terms of its population’s occupations, shows a preference for Lassalle.</p></li>
<li><p>The analysis of education, socio-professional categories, urban density, and income levels has allowed us to go further in the characterization of clusters. Overall, this dual clustering provides a comprehensive view of the interplay between political preferences, socio-economic factors, and geographic distribution across France.</p></li>
<li><p>It may also illustrate the geographical divisions within the country and provide insights into the rise of the far-right in France.</p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>